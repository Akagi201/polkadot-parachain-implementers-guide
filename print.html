<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Polkadot 平行链实现指南</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">前言</a></li><li class="chapter-item expanded "><a href="whence-parachains.html"><strong aria-hidden="true">1.</strong> 平行链从何而来</a></li><li class="chapter-item expanded "><a href="protocol-overview.html"><strong aria-hidden="true">2.</strong> 协议概览</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="protocol-approval.html"><strong aria-hidden="true">2.1.</strong> 审批程序</a></li><li class="chapter-item expanded "><a href="protocol-disputes.html"><strong aria-hidden="true">2.2.</strong> 争议程序</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="disputes-flow.html"><strong aria-hidden="true">2.2.1.</strong> 争议工作流</a></li></ol></li><li class="chapter-item expanded "><a href="protocol-chain-selection.html"><strong aria-hidden="true">2.3.</strong> 链选择和最终化</a></li></ol></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">3.</strong> 架构概览</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="messaging.html"><strong aria-hidden="true">3.1.</strong> 消息概览</a></li><li class="chapter-item expanded "><a href="pvf-prechecking.html"><strong aria-hidden="true">3.2.</strong> PVF 预检测</a></li></ol></li><li class="chapter-item expanded "><a href="runtime/index.html"><strong aria-hidden="true">4.</strong> 运行时架构</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="runtime/initializer.html"><strong aria-hidden="true">4.1.</strong> Initializer 模块</a></li><li class="chapter-item expanded "><a href="runtime/configuration.html"><strong aria-hidden="true">4.2.</strong> Configuration 模块</a></li><li class="chapter-item expanded "><a href="runtime/shared.html"><strong aria-hidden="true">4.3.</strong> Shared 模块</a></li><li class="chapter-item expanded "><a href="runtime/disputes.html"><strong aria-hidden="true">4.4.</strong> Disputes 模块</a></li><li class="chapter-item expanded "><a href="runtime/paras.html"><strong aria-hidden="true">4.5.</strong> Paras 模块</a></li><li class="chapter-item expanded "><a href="runtime/scheduler.html"><strong aria-hidden="true">4.6.</strong> Scheduler 模块</a></li><li class="chapter-item expanded "><a href="runtime/inclusion.html"><strong aria-hidden="true">4.7.</strong> Inclusion 模块</a></li><li class="chapter-item expanded "><a href="runtime/parainherent.html"><strong aria-hidden="true">4.8.</strong> ParaInherent 模块</a></li><li class="chapter-item expanded "><a href="runtime/dmp.html"><strong aria-hidden="true">4.9.</strong> DMP 模块</a></li><li class="chapter-item expanded "><a href="runtime/ump.html"><strong aria-hidden="true">4.10.</strong> UMP 模块</a></li><li class="chapter-item expanded "><a href="runtime/hrmp.html"><strong aria-hidden="true">4.11.</strong> HRMP 模块</a></li><li class="chapter-item expanded "><a href="runtime/session_info.html"><strong aria-hidden="true">4.12.</strong> Session Info 模块</a></li></ol></li><li class="chapter-item expanded "><a href="runtime-api/index.html"><strong aria-hidden="true">5.</strong> 运行时 APIs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="runtime-api/validators.html"><strong aria-hidden="true">5.1.</strong> 验证人</a></li><li class="chapter-item expanded "><a href="runtime-api/validator-groups.html"><strong aria-hidden="true">5.2.</strong> 验证人 Groups</a></li><li class="chapter-item expanded "><a href="runtime-api/availability-cores.html"><strong aria-hidden="true">5.3.</strong> 可用性核心</a></li><li class="chapter-item expanded "><a href="runtime-api/persisted-validation-data.html"><strong aria-hidden="true">5.4.</strong> 持久性验证数据</a></li><li class="chapter-item expanded "><a href="runtime-api/session-index.html"><strong aria-hidden="true">5.5.</strong> Session 索引</a></li><li class="chapter-item expanded "><a href="runtime-api/validation-code.html"><strong aria-hidden="true">5.6.</strong> 验证代码</a></li><li class="chapter-item expanded "><a href="runtime-api/candidate-pending-availability.html"><strong aria-hidden="true">5.7.</strong> 候选待定可用性</a></li><li class="chapter-item expanded "><a href="runtime-api/candidate-events.html"><strong aria-hidden="true">5.8.</strong> 候选者事件</a></li><li class="chapter-item expanded "><a href="runtime-api/disputes-info.html"><strong aria-hidden="true">5.9.</strong> 争议信息</a></li><li class="chapter-item expanded "><a href="runtime-api/candidates-included.html"><strong aria-hidden="true">5.10.</strong> 包含的候选者</a></li><li class="chapter-item expanded "><a href="runtime-api/pvf-prechecking.html"><strong aria-hidden="true">5.11.</strong> PVF 预检查</a></li></ol></li><li class="chapter-item expanded "><a href="node/index.html"><strong aria-hidden="true">6.</strong> 节点架构</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/subsystems-and-jobs.html"><strong aria-hidden="true">6.1.</strong> 子系统和工作</a></li><li class="chapter-item expanded "><a href="node/overseer.html"><strong aria-hidden="true">6.2.</strong> 监督员</a></li><li class="chapter-item expanded "><a href="node/grandpa-voting-rule.html"><strong aria-hidden="true">6.3.</strong> GRANDPA 投票规则</a></li><li class="chapter-item expanded "><a href="node/collators/index.html"><strong aria-hidden="true">6.4.</strong> 收集人子系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/collators/collation-generation.html"><strong aria-hidden="true">6.4.1.</strong> 收集人产生</a></li><li class="chapter-item expanded "><a href="node/collators/collator-protocol.html"><strong aria-hidden="true">6.4.2.</strong> 收集人协议</a></li></ol></li><li class="chapter-item expanded "><a href="node/backing/index.html"><strong aria-hidden="true">6.5.</strong> 支持子系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/backing/candidate-backing.html"><strong aria-hidden="true">6.5.1.</strong> 候选者支持</a></li><li class="chapter-item expanded "><a href="node/backing/statement-distribution.html"><strong aria-hidden="true">6.5.2.</strong> 报表分发</a></li></ol></li><li class="chapter-item expanded "><a href="node/availability/index.html"><strong aria-hidden="true">6.6.</strong> 可用性子系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/availability/availability-distribution.html"><strong aria-hidden="true">6.6.1.</strong> 可用性分发</a></li><li class="chapter-item expanded "><a href="node/availability/availability-recovery.html"><strong aria-hidden="true">6.6.2.</strong> 可用性恢复</a></li><li class="chapter-item expanded "><a href="node/availability/bitfield-distribution.html"><strong aria-hidden="true">6.6.3.</strong> Bitfield 分发</a></li><li class="chapter-item expanded "><a href="node/availability/bitfield-signing.html"><strong aria-hidden="true">6.6.4.</strong> Bitfield 签名</a></li></ol></li><li class="chapter-item expanded "><a href="node/approval/index.html"><strong aria-hidden="true">6.7.</strong> 审批子系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/approval/approval-voting.html"><strong aria-hidden="true">6.7.1.</strong> 审批投票</a></li><li class="chapter-item expanded "><a href="node/approval/approval-distribution.html"><strong aria-hidden="true">6.7.2.</strong> 审批分发</a></li></ol></li><li class="chapter-item expanded "><a href="node/disputes/index.html"><strong aria-hidden="true">6.8.</strong> 争议子系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/disputes/dispute-coordinator.html"><strong aria-hidden="true">6.8.1.</strong> 争议协调员</a></li><li class="chapter-item expanded "><a href="node/disputes/dispute-distribution.html"><strong aria-hidden="true">6.8.2.</strong> 争议分发</a></li></ol></li><li class="chapter-item expanded "><a href="node/utility/index.html"><strong aria-hidden="true">6.9.</strong> 实用工具子系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/utility/availability-store.html"><strong aria-hidden="true">6.9.1.</strong> 可用性商店</a></li><li class="chapter-item expanded "><a href="node/utility/candidate-validation.html"><strong aria-hidden="true">6.9.2.</strong> 候选人验证</a></li><li class="chapter-item expanded "><a href="node/utility/provisioner.html"><strong aria-hidden="true">6.9.3.</strong> 提供者</a></li><li class="chapter-item expanded "><a href="node/utility/network-bridge.html"><strong aria-hidden="true">6.9.4.</strong> 网络桥</a></li><li class="chapter-item expanded "><a href="node/utility/gossip-support.html"><strong aria-hidden="true">6.9.5.</strong> Gossip 支持</a></li><li class="chapter-item expanded "><a href="node/utility/misbehavior-arbitration.html"><strong aria-hidden="true">6.9.6.</strong> 不良行为仲裁</a></li><li class="chapter-item expanded "><a href="node/utility/peer-set-manager.html"><strong aria-hidden="true">6.9.7.</strong> 对等集合管理员</a></li><li class="chapter-item expanded "><a href="node/utility/runtime-api.html"><strong aria-hidden="true">6.9.8.</strong> 运行时 API 请求</a></li><li class="chapter-item expanded "><a href="node/utility/chain-api.html"><strong aria-hidden="true">6.9.9.</strong> 链 API 请求</a></li><li class="chapter-item expanded "><a href="node/utility/chain-selection.html"><strong aria-hidden="true">6.9.10.</strong> 链选择请求</a></li><li class="chapter-item expanded "><a href="node/utility/pvf-prechecker.html"><strong aria-hidden="true">6.9.11.</strong> PVF 预检查</a></li></ol></li><li class="chapter-item expanded "><a href="types/index.html"><strong aria-hidden="true">6.10.</strong> 数据结构和类型</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="types/candidate.html"><strong aria-hidden="true">6.10.1.</strong> 候选人</a></li><li class="chapter-item expanded "><a href="types/backing.html"><strong aria-hidden="true">6.10.2.</strong> 支持</a></li><li class="chapter-item expanded "><a href="types/availability.html"><strong aria-hidden="true">6.10.3.</strong> 可用性</a></li><li class="chapter-item expanded "><a href="types/overseer-protocol.html"><strong aria-hidden="true">6.10.4.</strong> 监督员和子系统协议</a></li><li class="chapter-item expanded "><a href="types/runtime.html"><strong aria-hidden="true">6.10.5.</strong> 运行时</a></li><li class="chapter-item expanded "><a href="types/chain.html"><strong aria-hidden="true">6.10.6.</strong> 链</a></li><li class="chapter-item expanded "><a href="types/messages.html"><strong aria-hidden="true">6.10.7.</strong> 消息</a></li><li class="chapter-item expanded "><a href="types/network.html"><strong aria-hidden="true">6.10.8.</strong> 网络</a></li><li class="chapter-item expanded "><a href="types/approval.html"><strong aria-hidden="true">6.10.9.</strong> 审批</a></li><li class="chapter-item expanded "><a href="types/disputes.html"><strong aria-hidden="true">6.10.10.</strong> 争议</a></li><li class="chapter-item expanded "><a href="types/pvf-prechecking.html"><strong aria-hidden="true">6.10.11.</strong> PVF 预检查</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="glossary.html">术语</a></li><li class="chapter-item expanded affix "><a href="further-reading.html">进一步阅读</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Polkadot 平行链实现指南</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="前言"><a class="header" href="#前言">前言</a></h1>
<p>本文件旨在描述 Polkadot 的平行链的功能主机的目的、功能和实现--即为组成平行链提供安全和推进的软件。它不是为一个特定的平行链的实现者，而是为平行链主机的实现者。实际上，这是为一般的 Polkadot 的实现者准备的。</p>
<p>还有一些其他文件更详细地描述了这项研究。所有参考文件都将在此链接，并应与本文件一起阅读，以获得对全貌的最佳理解。然而，这是唯一一份旨在描述 Polkadot 特定实例的关键方面的文件，其中包括许多研究的低层次技术细节和软件架构。</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="平行链从何而来"><a class="header" href="#平行链从何而来">平行链从何而来</a></h1>
<p>平行链是问题的解决方案。就像任何解决方案一样，如果不首先了解问题，就无法理解它。因此，让我们先来看看区块链技术所面临的问题，这些问题导致我们开始探索类似于平行链的设计空间。</p>
<h2 id="问题-1-扩展性"><a class="header" href="#问题-1-扩展性">问题 1: 扩展性</a></h2>
<p>几年前，简单的工作证明（PoW）区块链，如比特币、以太坊和无数其他区块链的交易吞吐量显然太低。</p>
<blockquote>
<p>TODO: 如果有更多的区块链，等等。</p>
</blockquote>
<p>权益证明（PoS）系统可以完成比 PoW 区块链更高的吞吐量。PoS 系统是由绑定的资本而不是花费的算力来保证的--流动性机会成本与燃烧的电力。它们的工作方式是选择一组具有已知经济身份的验证者，他们锁定代币以换取 &quot;验证&quot; 或参与共识过程的权利。如果他们被发现错误地执行该过程，他们将被惩罚，这意味着部分或全部被锁定的代币将被烧毁。这提供了一个强大的抑制不当行为的方向。</p>
<p>由于共识协议不围绕着浪费算力，区块时间和协议可以更快发生。在编写区块之前，不必找到 PoW 挑战的解决方案，因此编写区块的开销被减少到只有创建和分发区块的成本。</p>
<p>然而，PoS 链上的共识需要 2/3 以上的验证者对发生在第一层的一切达成完全一致：所有的逻辑都是作为区块链的状态机的一部分进行的。这意味着每个人仍然需要检查一切。此外，验证者可能会根据他们在异步网络上收到的信息对系统有不同的看法，这使得对最新状态的共识更加困难。</p>
<p>平行链是一个<strong>分片</strong>协议的例子。分片是一个从传统数据库架构中借用的概念。我们不要求每个参与者检查每笔交易，而是要求每个参与者检查一些交易的子集，其中有足够的冗余，使那些杂乱无章的（任意恶意的）参与者不能偷偷地进入无效的交易--至少不会被发现并被惩罚，这些交易会被恢复。</p>
<p>分片和权益证明相互协调，允许一个平行链主机在许多平行链上提供完全的安全性，即使没有所有参与者检查所有的状态转换。</p>
<blockquote>
<p>TODO: 注意网络影响和桥接</p>
</blockquote>
<h2 id="问题-2-灵活性专业化"><a class="header" href="#问题-2-灵活性专业化">问题 2: 灵活性/专业化</a></h2>
<p>&quot;dumb&quot; 虚拟机并没有给你带来灵活性。任何工程师都知道，能够对一个问题进行专业化的处理会给他们和他们的用户带来更多的 <em>杠杆</em>。</p>
<blockquote>
<p>TODO: 扩展杠杆</p>
</blockquote>
<p>认识到这些问题后，我们开始寻找解决这些问题的方法，这可以让开发者创建和部署专用的区块链，统一在一个共同的安全源下，并且能够在它们之间进行消息传递；一个 <em>异质分片解决方案</em>，我们称之为<strong>平行链</strong>。</p>
<div style="break-before: page; page-break-before: always;"></div><!-- markdownlint-disable MD010 -->
<h1 id="协议概览"><a class="header" href="#协议概览">协议概览</a></h1>
<p>本节旨在高水平地描述在 Polkadot 中运行平行链所涉及的角色和协议。具体来说，我们描述了不同的行为者如何相互沟通，他们单独和集体保存什么样的数据结构，以及他们为什么要做这些事情的高级目的。</p>
<p>我们的最高目标是将一个平行链区块从编写到安全包含，并定义一个可以重复和平行进行的过程，用于许多不同的平行链，以便随着时间的推移扩展它们。理解这里所采取的高层次的方法对于进一步提供拟议的架构的背景是很重要的。与此相关的 Polkadot 的关键部分是主要的 Polkadot 区块链，被称为中继链，以及为该区块链提供安全和输入的行为者。</p>
<p>首先，有必要介绍一下我们参与这个协议的主要行为者。</p>
<ol>
<li>验证人。这些节点负责验证拟议的平行链区块。他们通过检查区块的有效性证明（PoV）来做到这一点，并确保 PoV 仍然可用。他们把金融资本作为 &quot;游戏中的皮肤&quot;，如果他们被证明是错误的验证，可以被砍掉（销毁）。</li>
<li>收集人。这些节点负责创建验证人知道如何检查的有效性证明。创建 PoV 通常需要熟悉交易格式和平行链的区块编写规则，以及能够访问平行链的全部状态。</li>
<li>渔民。这些是由用户操作的、无权限的节点，其目标是抓住行为不端的验证人以换取赏金。收集人和验证人也可以作为 &quot;渔夫&quot; 行事。渔民对于安全来说并不是必须的，而且本文也没有深入涉及。</li>
</ol>
<p>这意味着一个简单的管道，收集人向验证人发送平行链区块和其必要的 PoV 来检查。然后，验证人使用 PoV 验证区块，签署描述积极或消极结果的声明，如果有足够的积极声明，该区块可以在中继链上被注意到。负面的声明不是否决，但会导致争议，那些错误的一方会被惩罚。如果另一个验证人后来发现一个验证人或一组验证人错误地签署了一份声明，声称一个区块是有效的，那么这些验证人将被惩罚，而验证人将获得赏金。</p>
<p>然而，这种表述有一个问题。为了让另一个验证人在事后检查前一组验证人的工作，PoV 必须保持 <em>可用</em>，以便其他验证人可以获取它以检查工作。预计 PoVs 太大，无法直接包含在区块链中，所以我们需要一个替代的 <em>数据可用性</em> 方案，要求验证人证明他们工作的输入将保持可用，所以他们的工作可以被检查。经验性测试告诉我们，许多 PoV 在重载期间可能在 1 到 10MB 之间。</p>
<p>下面是对包含管道的描述：一个平行链区块（或简称 parablock）从创建到包含的路径。</p>
<ol>
<li>验证人是由验证人分配程序选择并分配给平行链的。</li>
<li>收集人产生平行链区块，它被称为平行链候选人或候选人，同时还有候选人的 PoV。</li>
<li>收集人通过收集人协议将候选人和 PoV 转发给分配给同一平行链的验证人。</li>
<li>在某一特定时间点分配到某一平行链的验证人参与到候选人支持子系统中，以验证被提出来验证的候选人。从验证人那里收集到足够多的签名有效性声明的候选人被认为是 &quot;可支持的&quot;。他们的支持是已签署的有效性声明的集合。</li>
<li>由 BABE 选择的中继链区块的作者，可以为每个平行链记下最多一个可支持的候选者，并将其与支持一起纳入中继链区块。一个可支持的候选者一旦被纳入中继链，就被认为在中继链的那个分叉中得到了支持。</li>
<li>一旦在中继链中得到支持，该平行链候选者就被认为是 &quot;待定可用性&quot;。它不被认为是作为平行链的一部分，直到它被证明是可用的。</li>
<li>在接下来的中继链区块中，验证人将参与可用性分布子系统以确保候选者的可用性。有关候选者可用性的信息将在随后的中继链块中被指出。</li>
<li>一旦中继链状态机有足够的信息认为候选人的 PoV 是可用的，该候选人就被认为是平行链的一部分，并逐渐成为一个完整的平行链区块，或简称为 parablock。</li>
</ol>
<p>请注意，候选人可以在以下任何一种情况下不被列入：</p>
<ul>
<li>收集人无法将该候选者传播给分配给该平行链的任何验证人。</li>
<li>候选人没有被参与候选人支持子系统的验证人支持。</li>
<li>候选人没有被中继链区块作者选择纳入中继链。</li>
<li>候选人的 PoV 在超时内不被认为是可用的，并被从中继链中丢弃。</li>
</ul>
<p>这个过程还可以进一步划分。步骤 2 和 3 与收集人的工作有关，即整理并通过整理分发子系统将候选人分发至验证人。步骤 3 和 4 涉及到候选人支持子系统中的验证人和区块作者（本身就是一个验证人）的工作，将区块纳入中继链。步骤 6、7 和 8 对应于中继链状态机的逻辑（也称为运行时），用于将区块完全纳入链中。第 7 步需要验证人的进一步工作，以参与可用性分布子系统，并将该信息纳入中继链，以便第 8 步完全实现。</p>
<p>这给我们带来了该过程的第二部分。一旦一个 parablock 被认为是可用的和平行链的一部分，它仍然是 &quot;等待批准&quot;。在流水线的这一阶段，该 parablock 已经得到了分配给该 parablock 的小组中大多数验证人的支持，其数据已经被整个验证人集合保证为可用。一旦它被认为是可用的，主机甚至会开始接受该块的子块。在这一点上，我们可以认为该区块已经被暂时包含在平行链中，尽管还需要更多的确认。然而，平行链组中的验证人（被称为该平行链的 &quot;平行链验证人&quot;）是从一个验证人集合中抽出的，这个验证人集合中含有一定比例的拜占庭，或者任意的恶意成员。这就意味着，某些区块的平行链验证人可能是多数人不诚实的，这意味着在区块被认为是被批准之前，必须对其进行（二次）批准检查。这一点是必要的，因为一个给定的 parachain 的验证人是从整个验证人集合中抽取的，而这个验证人集合被假定为最多&lt;1/3 不诚实--这意味着有机会随机抽取 parachain 的验证人，这些验证人多数或完全不诚实，可能错误地支持一个候选人。审批程序允许我们在事后发现这种错误行为，而不需要分配更多的 Parachain 验证人，并减少系统的吞吐量。一个 parablock 未能通过审批过程，将使该区块以及其所有的子代无效。然而，只有支持有问题的区块的验证人会被惩罚，而不是支持后代的验证人。</p>
<p>审批程序，一目了然，看起来像这样：</p>
<ol>
<li>被纳入流水线的 Parablocks 正在等待批准，其时间窗口被称为二次检查窗口。</li>
<li>在二次检查窗口期间，验证人随机地自我选择对 parablock 进行二次检查。</li>
<li>这些验证人在这里被称为二次检查者，他们获得了 parablock 和其 PoV，并重新运行验证功能。</li>
<li>二级检查员对他们的检查结果进行 gossip。相互矛盾的结果会导致升级，所有验证人都需要检查该块。争端中失败一方的验证人被惩罚。</li>
<li>在审批过程结束时，该区块要么被批准，要么被拒绝。稍后会有更多关于拒绝过程的内容。</li>
</ol>
<p>关于审批程序的更多信息，可在 &quot;审批&quot; 专门章节中找到。关于争议的更多信息，可在 &quot;争议&quot; 的专门章节中找到。</p>
<p>这两条流水线总结了扩展和获得一个 Parablock 的全部安全所需的事件顺序。请注意，在接受一个新的区块之前，必须结束对一个特定的 parachain 的包含流水线。纳入后，审批程序开始启动，可以同时为许多平行链区块运行。</p>
<p>重申候选人的生命周期：</p>
<ol>
<li>候选：由一个收集人向一个验证人提出。</li>
<li>附议：由一个验证人向其他验证人提出。</li>
<li>可支持：由大多数指定的验证人证明的有效性。</li>
<li>被支持：可支持的并在中继链的分叉中指出。</li>
<li>待定的可用性：有支持，但还没有被认为是可用的。</li>
<li>包含：已支持并被认为是可用的。</li>
<li>接受：已支持，可使用，且无争议。</li>
</ol>
<div><!-- Generated by graphviz version 2.43.0 (0)
 --><!-- Title: %3 Pages: 1 --><svg width="446pt" height="779pt"
 viewBox="0.00 0.00 446.00 779.25" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 775.25)"><title>%3</title><polygon fill="white" stroke="transparent" points="-4,4 -4,-775.25 442,-775.25 442,4 -4,4"/><g id="clust1" class="cluster"><title>cluster_vg</title><polygon fill="lightgrey" stroke="lightgrey" points="8,-444.25 8,-694.25 309,-694.25 309,-444.25 8,-444.25"/><text text-anchor="start" x="16" y="-679.05" font-family="Times,serif" font-size="14.00">Parachain Validators</text><text text-anchor="start" x="41" y="-664.05" font-family="Times,serif" font-size="14.00">(subset of all)</text></g><g id="clust2" class="cluster"><title>cluster_approval</title><polygon fill="lightgrey" stroke="lightgrey" points="8,-79 8,-169 430,-169 430,-79 8,-79"/><text text-anchor="start" x="16" y="-153.8" font-family="Times,serif" font-size="14.00">Secondary Checkers</text><text text-anchor="start" x="40" y="-138.8" font-family="Times,serif" font-size="14.00">(subset of all)</text></g><!-- v1 --><g id="node1" class="node"><title>v1</title><ellipse fill="white" stroke="white" cx="200" cy="-630.25" rx="61.99" ry="18"/><text text-anchor="middle" x="200" y="-626.55" font-family="Times,serif" font-size="14.00">Validator 1</text></g><!-- v2 --><g id="node2" class="node"><title>v2</title><ellipse fill="white" stroke="white" cx="78" cy="-543.25" rx="61.99" ry="18"/><text text-anchor="middle" x="78" y="-539.55" font-family="Times,serif" font-size="14.00">Validator 2</text></g><!-- v1&#45;&gt;v2 --><g id="edge1" class="edge"><title>v1&#45;&gt;v2</title><path fill="none" stroke="black" d="M148.9,-620.02C131.72,-614.82 113.5,-606.75 100,-594.25 93.29,-588.05 88.52,-579.44 85.17,-571.11"/><polygon fill="black" stroke="black" points="88.46,-569.91 81.87,-561.62 81.85,-572.21 88.46,-569.91"/><text text-anchor="middle" x="147" y="-583.05" font-family="Times,serif" font-size="14.00">(2) Seconded</text></g><!-- v3 --><g id="node3" class="node"><title>v3</title><ellipse fill="white" stroke="white" cx="219" cy="-543.25" rx="61.99" ry="18"/><text text-anchor="middle" x="219" y="-539.55" font-family="Times,serif" font-size="14.00">Validator 3</text></g><!-- v1&#45;&gt;v3 --><g id="edge2" class="edge"><title>v1&#45;&gt;v3</title><path fill="none" stroke="black" d="M198.44,-611.87C198.04,-602.14 198.32,-589.86 201,-579.25 201.76,-576.24 202.82,-573.19 204.05,-570.21"/><polygon fill="black" stroke="black" points="207.26,-571.62 208.39,-561.08 200.94,-568.61 207.26,-571.62"/><text text-anchor="middle" x="248" y="-583.05" font-family="Times,serif" font-size="14.00">(2) Seconded</text></g><!-- b --><g id="node4" class="node"><title>b</title><polygon fill="white" stroke="white" points="271.5,-488.25 166.5,-488.25 166.5,-452.25 271.5,-452.25 271.5,-488.25"/><text text-anchor="middle" x="219" y="-466.55" font-family="Times,serif" font-size="14.00">(3) Backable</text></g><!-- v1&#45;&gt;b --><g id="edge5" class="edge"><title>v1&#45;&gt;b</title><path fill="none" stroke="black" stroke-dasharray="5,2" d="M254.13,-621.39C269.9,-616.3 285.45,-607.95 295,-594.25 303.03,-582.74 311.74,-564.45 290,-525.25 281.44,-509.82 266.42,-497.42 252.4,-488.42"/></g><!-- v2&#45;&gt;b --><g id="edge3" class="edge"><title>v2&#45;&gt;b</title><path fill="none" stroke="black" stroke-dasharray="5,2" d="M107.56,-527.37C130.17,-515.99 161.38,-500.27 185.02,-488.37"/></g><!-- v3&#45;&gt;b --><g id="edge4" class="edge"><title>v3&#45;&gt;b</title><path fill="none" stroke="black" stroke-dasharray="5,2" d="M219,-525.07C219,-513.9 219,-499.42 219,-488.28"/></g><!-- v4 --><g id="node5" class="node"><title>v4</title><ellipse fill="none" stroke="black" cx="219" cy="-378.63" rx="138.69" ry="22.76"/><text text-anchor="start" x="129" y="-380.43" font-family="Times,serif" font-weight="bold" font-size="14.00">Validator 4</text><text text-anchor="start" x="215" y="-380.43" font-family="Times,serif" font-size="14.00"> (relay chain)</text><text text-anchor="start" x="169.5" y="-369.63" font-family="Times,serif" font-size="10.00">(selected by BABE)</text></g><!-- b&#45;&gt;v4 --><g id="edge6" class="edge"><title>b&#45;&gt;v4</title><path fill="none" stroke="black" d="M219,-451.97C219,-440.46 219,-424.99 219,-411.31"/><polygon fill="black" stroke="black" points="222.5,-411.3 219,-401.3 215.5,-411.3 222.5,-411.3"/><text text-anchor="middle" x="257" y="-423.05" font-family="Times,serif" font-size="14.00">(4) Backed</text></g><!-- pa --><g id="node7" class="node"><title>pa</title><polygon fill="none" stroke="black" points="359.5,-319 78.5,-319 78.5,-283 359.5,-283 359.5,-319"/><text text-anchor="middle" x="219" y="-297.3" font-family="Times,serif" font-size="14.00">(5) Relay Block (Pending Availability)</text></g><!-- v4&#45;&gt;pa --><g id="edge8" class="edge"><title>v4&#45;&gt;pa</title><path fill="none" stroke="black" d="M219,-355.75C219,-347.44 219,-337.87 219,-329.13"/><polygon fill="black" stroke="black" points="222.5,-329.02 219,-319.02 215.5,-329.02 222.5,-329.02"/></g><!-- col --><g id="node6" class="node"><title>col</title><ellipse fill="none" stroke="black" cx="200" cy="-753.25" rx="48.19" ry="18"/><text text-anchor="middle" x="200" y="-749.55" font-family="Times,serif" font-size="14.00">Collator</text></g><!-- col&#45;&gt;v1 --><g id="edge7" class="edge"><title>col&#45;&gt;v1</title><path fill="none" stroke="black" d="M200,-735.18C200,-715.29 200,-682.18 200,-658.68"/><polygon fill="black" stroke="black" points="203.5,-658.64 200,-648.64 196.5,-658.64 203.5,-658.64"/><text text-anchor="middle" x="248.5" y="-706.05" font-family="Times,serif" font-size="14.00">(1) Candidate</text></g><!-- pb --><g id="node8" class="node"><title>pb</title><polygon fill="none" stroke="black" points="262,-232 176,-232 176,-196 262,-196 262,-232"/><text text-anchor="middle" x="219" y="-210.3" font-family="Times,serif" font-size="14.00">Parablock</text></g><!-- pa&#45;&gt;pb --><g id="edge9" class="edge"><title>pa&#45;&gt;pb</title><path fill="none" stroke="black" d="M219,-282.8C219,-268.05 219,-246.92 219,-232.18"/><text text-anchor="middle" x="300.5" y="-253.8" font-family="Times,serif" font-size="14.00">(6) a few blocks later...</text></g><!-- a5 --><g id="node10" class="node"><title>a5</title><ellipse fill="white" stroke="white" cx="78" cy="-105" rx="61.99" ry="18"/><text text-anchor="middle" x="78" y="-101.3" font-family="Times,serif" font-size="14.00">Validator 5</text></g><!-- pb&#45;&gt;a5 --><g id="edge10" class="edge"><title>pb&#45;&gt;a5</title><path fill="none" stroke="black" d="M188.86,-195.94C175.93,-188.22 160.87,-178.66 148,-169 131.82,-156.86 114.93,-141.74 101.8,-129.35"/><polygon fill="black" stroke="black" points="104.18,-126.79 94.53,-122.42 99.35,-131.86 104.18,-126.79"/></g><!-- a6 --><g id="node11" class="node"><title>a6</title><ellipse fill="white" stroke="white" cx="219" cy="-105" rx="61.99" ry="18"/><text text-anchor="middle" x="219" y="-101.3" font-family="Times,serif" font-size="14.00">Validator 6</text></g><!-- pb&#45;&gt;a6 --><g id="edge11" class="edge"><title>pb&#45;&gt;a6</title><path fill="none" stroke="black" d="M219,-195.81C219,-178.96 219,-153.02 219,-133.34"/><polygon fill="black" stroke="black" points="222.5,-133.15 219,-123.15 215.5,-133.15 222.5,-133.15"/></g><!-- a7 --><g id="node12" class="node"><title>a7</title><ellipse fill="white" stroke="white" cx="360" cy="-105" rx="61.99" ry="18"/><text text-anchor="middle" x="360" y="-101.3" font-family="Times,serif" font-size="14.00">Validator 7</text></g><!-- pb&#45;&gt;a7 --><g id="edge12" class="edge"><title>pb&#45;&gt;a7</title><path fill="none" stroke="black" d="M249.14,-195.94C262.07,-188.22 277.13,-178.66 290,-169 306.18,-156.86 323.07,-141.74 336.2,-129.35"/><polygon fill="black" stroke="black" points="338.65,-131.86 343.47,-122.42 333.82,-126.79 338.65,-131.86"/></g><!-- rc --><g id="node9" class="node"><title>rc</title><ellipse fill="none" stroke="black" cx="219" cy="-18" rx="116.18" ry="18"/><text text-anchor="middle" x="219" y="-14.3" font-family="Times,serif" font-size="14.00">Relay Chain Validators</text></g><!-- a5&#45;&gt;rc --><g id="edge13" class="edge"><title>a5&#45;&gt;rc</title><path fill="none" stroke="black" d="M89.37,-87.17C97.4,-76.41 109,-62.85 122,-54 131.56,-47.49 142.47,-42.04 153.44,-37.53"/><polygon fill="black" stroke="black" points="155,-40.68 163.06,-33.8 152.47,-34.15 155,-40.68"/><text text-anchor="middle" x="168.5" y="-57.8" font-family="Times,serif" font-size="14.00">(7) Approved</text></g><!-- a6&#45;&gt;rc --><g id="edge14" class="edge"><title>a6&#45;&gt;rc</title><path fill="none" stroke="black" d="M219,-86.8C219,-75.16 219,-59.55 219,-46.24"/><polygon fill="black" stroke="black" points="222.5,-46.18 219,-36.18 215.5,-46.18 222.5,-46.18"/><text text-anchor="middle" x="265.5" y="-57.8" font-family="Times,serif" font-size="14.00">(7) Approved</text></g><!-- a7&#45;&gt;rc --><g id="edge15" class="edge"><title>a7&#45;&gt;rc</title><path fill="none" stroke="black" d="M348.63,-87.17C340.6,-76.41 329,-62.85 316,-54 306.44,-47.49 295.53,-42.04 284.56,-37.53"/><polygon fill="black" stroke="black" points="285.53,-34.15 274.94,-33.8 283,-40.68 285.53,-34.15"/><text text-anchor="middle" x="378.5" y="-57.8" font-family="Times,serif" font-size="14.00">(7) Approved</text></g></g></svg></div>
<p>上图显示了一个区块从（1）候选状态到（7）批准状态的乐观路径。</p>
<p>还需要注意的是，中继链是由 BABE 扩展的，它是一种分叉算法。这意味着不同的区块作者可以同时被选择，而且可能不是建立在同一个区块父本上。此外，验证人的集合并不固定，平行链的集合也不固定。而且，即使有相同的验证人和平行链集，验证人对平行链集的分配也是灵活的。这意味着，在接下来的章节中提出的架构必须处理网络状态的可变性和多重性。</p>
<div><!-- Generated by graphviz version 2.43.0 (0)
 --><!-- Title: %3 Pages: 1 --><svg width="412pt" height="392pt"
 viewBox="0.00 0.00 412.20 391.53" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 387.53)"><title>%3</title><polygon fill="white" stroke="transparent" points="-4,4 -4,-387.53 408.2,-387.53 408.2,4 -4,4"/><!-- rca --><g id="node1" class="node"><title>rca</title><polygon fill="none" stroke="black" points="304.6,-36 190.6,-36 190.6,0 304.6,0 304.6,-36"/><text text-anchor="middle" x="247.6" y="-14.3" font-family="Times,serif" font-size="14.00">Relay Block A</text></g><!-- rcb --><g id="node2" class="node"><title>rcb</title><polygon fill="none" stroke="black" points="305.1,-109 190.1,-109 190.1,-73 305.1,-73 305.1,-109"/><text text-anchor="middle" x="247.6" y="-87.3" font-family="Times,serif" font-size="14.00">Relay Block B</text></g><!-- rcb&#45;&gt;rca --><g id="edge1" class="edge"><title>rcb&#45;&gt;rca</title><path fill="none" stroke="black" d="M247.6,-72.81C247.6,-64.79 247.6,-55.05 247.6,-46.07"/><polygon fill="black" stroke="black" points="251.1,-46.03 247.6,-36.03 244.1,-46.03 251.1,-46.03"/></g><!-- rcc --><g id="node3" class="node"><title>rcc</title><polygon fill="none" stroke="black" points="167.1,-217.6 52.1,-217.6 52.1,-181.6 167.1,-181.6 167.1,-217.6"/><text text-anchor="middle" x="109.6" y="-195.9" font-family="Times,serif" font-size="14.00">Relay Block C</text></g><!-- rcc&#45;&gt;rcb --><g id="edge2" class="edge"><title>rcc&#45;&gt;rcb</title><path fill="none" stroke="black" d="M131.77,-181.47C155.01,-163.52 191.66,-135.21 217.51,-115.25"/><polygon fill="black" stroke="black" points="219.71,-117.97 225.48,-109.08 215.43,-112.43 219.71,-117.97"/></g><!-- vg1 --><g id="node4" class="node"><title>vg1</title><ellipse fill="none" stroke="black" cx="109.6" cy="-336.87" rx="109.7" ry="46.84"/><text text-anchor="start" x="40.1" y="-355.67" font-family="Times,serif" font-weight="bold" font-size="14.00">Validator Group 1</text><text text-anchor="start" x="78.6" y="-330.87" font-family="Times,serif" font-size="10.00">(Validator 4)</text><text text-anchor="start" x="46.1" y="-320.87" font-family="Times,serif" font-size="10.00">(Validator 1) (Validator 2)</text><text text-anchor="start" x="78.6" y="-310.87" font-family="Times,serif" font-size="10.00">(Validator 5)</text></g><!-- vg1&#45;&gt;rcc --><g id="edge3" class="edge"><title>vg1&#45;&gt;rcc</title><path fill="none" stroke="black" stroke-dasharray="5,2" d="M109.6,-290.07C109.6,-265.24 109.6,-236 109.6,-217.88"/><text text-anchor="middle" x="158.1" y="-261" font-family="Times,serif" font-size="14.00">Building on C</text></g><!-- vg2 --><g id="node5" class="node"><title>vg2</title><ellipse fill="none" stroke="black" cx="294.6" cy="-199.6" rx="109.7" ry="39.7"/><text text-anchor="start" x="225.1" y="-213.4" font-family="Times,serif" font-weight="bold" font-size="14.00">Validator Group 2</text><text text-anchor="start" x="263.6" y="-188.6" font-family="Times,serif" font-size="10.00">(Validator 7)</text><text text-anchor="start" x="231.1" y="-178.6" font-family="Times,serif" font-size="10.00">(Validator 3) (Validator 6)</text></g><!-- vg2&#45;&gt;rcb --><g id="edge4" class="edge"><title>vg2&#45;&gt;rcb</title><path fill="none" stroke="black" stroke-dasharray="5,2" d="M277.77,-160.41C270.02,-142.85 261.23,-122.9 255.14,-109.09"/><text text-anchor="middle" x="316.1" y="-130.8" font-family="Times,serif" font-size="14.00">Building on B</text></g></g></svg></div>
<p>在这个例子中，第 1 组已经收到了 C 块，而其他组由于网络不同步而没有收到。现在，第 2 组的验证人可以在 B 的基础上建立另一个块，称为 C'。假设之后，一些验证人同时知道了 C 和 C'，而其他验证人仍然只知道一个。</p>
<div><!-- Generated by graphviz version 2.43.0 (0)
 --><!-- Title: %3 Pages: 1 --><svg width="701pt" height="303pt"
 viewBox="0.00 0.00 701.20 303.20" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 299.2)"><title>%3</title><polygon fill="white" stroke="transparent" points="-4,4 -4,-299.2 697.2,-299.2 697.2,4 -4,4"/><!-- rca --><g id="node1" class="node"><title>rca</title><polygon fill="none" stroke="black" points="402.6,-36 288.6,-36 288.6,0 402.6,0 402.6,-36"/><text text-anchor="middle" x="345.6" y="-14.3" font-family="Times,serif" font-size="14.00">Relay Block A</text></g><!-- rcb --><g id="node2" class="node"><title>rcb</title><polygon fill="none" stroke="black" points="403.1,-108 288.1,-108 288.1,-72 403.1,-72 403.1,-108"/><text text-anchor="middle" x="345.6" y="-86.3" font-family="Times,serif" font-size="14.00">Relay Block B</text></g><!-- rcb&#45;&gt;rca --><g id="edge1" class="edge"><title>rcb&#45;&gt;rca</title><path fill="none" stroke="black" d="M345.6,-71.7C345.6,-63.98 345.6,-54.71 345.6,-46.11"/><polygon fill="black" stroke="black" points="349.1,-46.1 345.6,-36.1 342.1,-46.1 349.1,-46.1"/></g><!-- rcc --><g id="node3" class="node"><title>rcc</title><polygon fill="none" stroke="black" points="336.1,-180 221.1,-180 221.1,-144 336.1,-144 336.1,-180"/><text text-anchor="middle" x="278.6" y="-158.3" font-family="Times,serif" font-size="14.00">Relay Block C</text></g><!-- rcc&#45;&gt;rcb --><g id="edge2" class="edge"><title>rcc&#45;&gt;rcb</title><path fill="none" stroke="black" d="M295.16,-143.7C303.28,-135.22 313.19,-124.86 322.07,-115.58"/><polygon fill="black" stroke="black" points="324.84,-117.75 329.23,-108.1 319.79,-112.91 324.84,-117.75"/></g><!-- rcc_prime --><g id="node4" class="node"><title>rcc_prime</title><polygon fill="none" stroke="black" points="473.1,-180 354.1,-180 354.1,-144 473.1,-144 473.1,-180"/><text text-anchor="middle" x="413.6" y="-158.3" font-family="Times,serif" font-size="14.00">Relay Block C&#39;</text></g><!-- rcc_prime&#45;&gt;rcb --><g id="edge3" class="edge"><title>rcc_prime&#45;&gt;rcb</title><path fill="none" stroke="black" d="M396.79,-143.7C388.48,-135.14 378.3,-124.66 369.21,-115.3"/><polygon fill="black" stroke="black" points="371.7,-112.84 362.22,-108.1 366.67,-117.72 371.7,-112.84"/></g><!-- vg1 --><g id="node5" class="node"><title>vg1</title><ellipse fill="none" stroke="black" cx="109.6" cy="-255.6" rx="109.7" ry="32.55"/><text text-anchor="start" x="40.1" y="-264.4" font-family="Times,serif" font-weight="bold" font-size="14.00">Validator Group 1</text><text text-anchor="start" x="46.1" y="-239.6" font-family="Times,serif" font-size="10.00">(Validator 4) (Validator 1)</text></g><!-- vg1&#45;&gt;rcc --><g id="edge4" class="edge"><title>vg1&#45;&gt;rcc</title><path fill="none" stroke="black" stroke-dasharray="5,2" d="M161.23,-226.62C189.18,-211.47 222.83,-193.23 246.91,-180.18"/></g><!-- vg2 --><g id="node6" class="node"><title>vg2</title><ellipse fill="none" stroke="black" cx="583.6" cy="-255.6" rx="109.7" ry="32.55"/><text text-anchor="start" x="514.1" y="-264.4" font-family="Times,serif" font-weight="bold" font-size="14.00">Validator Group 2</text><text text-anchor="start" x="520.1" y="-239.6" font-family="Times,serif" font-size="10.00">(Validator 7) (Validator 6)</text></g><!-- vg2&#45;&gt;rcc_prime --><g id="edge5" class="edge"><title>vg2&#45;&gt;rcc_prime</title><path fill="none" stroke="black" stroke-dasharray="5,2" d="M532.13,-226.87C503.89,-211.65 469.77,-193.26 445.4,-180.13"/></g><!-- vg3 --><g id="node7" class="node"><title>vg3</title><ellipse fill="none" stroke="black" cx="346.6" cy="-255.6" rx="109.7" ry="39.7"/><text text-anchor="start" x="277.1" y="-269.4" font-family="Times,serif" font-weight="bold" font-size="14.00">Validator Group 3</text><text text-anchor="start" x="283.1" y="-244.6" font-family="Times,serif" font-size="10.00">(Validator 2) (Validator 3)</text><text text-anchor="start" x="315.6" y="-234.6" font-family="Times,serif" font-size="10.00">(Validator 5)</text></g><!-- vg3&#45;&gt;rcc --><g id="edge7" class="edge"><title>vg3&#45;&gt;rcc</title><path fill="none" stroke="black" stroke-dasharray="5,2" d="M318.75,-217.08C309.21,-204.23 299.01,-190.49 291.27,-180.07"/></g><!-- vg3&#45;&gt;rcc_prime --><g id="edge6" class="edge"><title>vg3&#45;&gt;rcc_prime</title><path fill="none" stroke="black" stroke-dasharray="5,2" d="M374.05,-217.08C383.44,-204.23 393.5,-190.49 401.12,-180.07"/></g></g></svg></div>
<p>那些意识到许多竞争头的验证人必须意识到在每个头上发生的工作。他们可能对两个头都有一些或全部的贡献。由于网络的不同步性，两个分叉有可能在一段时间内平行增长，尽管在没有对抗性网络的情况下，在有验证人知道两个链头的情况下这是不可能的。</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="审批程序"><a class="header" href="#审批程序">审批程序</a></h1>
<p>审批程序是中继链确保只有有效的区块被最终确定的机制，而支持验证者要对设法将坏区块纳入中继链的行为负责。</p>
<p>只要区块没有被中继链的最终性程序 GRANDPA 最终确定，那么让一个平行链区块包含在中继链的分叉中并不是灾难性的。如果该区块没有被最终确定，这意味着中继链的分叉可以通过动态分叉选择规则来恢复，从而使诚实的验证者忽略任何包含该区块的分叉。</p>
<p>处理一个坏的分叉要经过以下几个阶段：</p>
<ol>
<li>检测</li>
<li>升级</li>
<li>结果</li>
</ol>
<p>首先，坏块必须被诚实的一方发现。其次，诚实的一方必须将坏块升级到由所有验证者检查。最后，一个坏区块的正确结果必须发生。第一个结果，如上所述，是恢复链，使所有节点认为是最好的，不再包含坏块。第二个结果是砍掉所有恶意验证者。请注意，如果包含坏块的链被还原，那么争议的结果需要被移植，或者至少可以移植到该链的所有其他分叉上，这样恶意验证者在所有可能的历史上都会被砍掉。换句话说，需要没有任何可能的中继链可以让恶意验证者无代价地逃脱。</p>
<p>接受一个 parablock 是通过检测阶段而没有争议的最终结果，或者是通过升级/争议阶段而获得积极的结果。为了使其发挥作用，我们需要检测程序具有这样的特性：总是选择足够多的诚实验证者来检查联锁，并且他们不能被对手干扰。这需要与一般的平行链的规模问题相平衡：获得第一个属性的最简单方法是让每个人都检查所有的东西，但这显然太沉重了。因此，我们对另一个属性也有一个期望的约束，即让尽可能少的验证者检查任何特定的 parablock。我们的赋值函数是我们选择验证人对 parablocks 进行批准检查的方法。</p>
<p>相对于考虑 parablocks 是否被批准而言，把中继链块看作是已经被批准或没有被批准，往往更有意义。含有一个坏块的中继链块需要被撤销，而只含有已批准的块的中继链块可以被称为已批准，只要其父中继链块也被批准。重要的是，任何特定的中继链块的有效性都取决于其祖先的有效性，因此我们不会最终确定一个在其祖先中有坏块的块。</p>
<div><!-- Generated by graphviz version 2.43.0 (0)
 --><!-- Title: %3 Pages: 1 --><svg width="275pt" height="260pt"
 viewBox="0.00 0.00 275.34 260.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 256)"><title>%3</title><polygon fill="white" stroke="transparent" points="-4,4 -4,-256 271.34,-256 271.34,4 -4,4"/><!-- Included --><g id="node1" class="node"><title>Included</title><ellipse fill="none" stroke="black" cx="119" cy="-234" rx="50.89" ry="18"/><text text-anchor="middle" x="119" y="-230.3" font-family="Times,serif" font-size="14.00">Included</text></g><!-- Assignments --><g id="node2" class="node"><title>Assignments</title><ellipse fill="none" stroke="black" cx="119" cy="-162" rx="70.39" ry="18"/><text text-anchor="middle" x="119" y="-158.3" font-family="Times,serif" font-size="14.00">Assignments</text></g><!-- Included&#45;&gt;Assignments --><g id="edge1" class="edge"><title>Included&#45;&gt;Assignments</title><path fill="none" stroke="black" d="M119,-215.7C119,-207.98 119,-198.71 119,-190.11"/><polygon fill="black" stroke="black" points="122.5,-190.1 119,-180.1 115.5,-190.1 122.5,-190.1"/></g><!-- Approval --><g id="node3" class="node"><title>Approval</title><ellipse fill="none" stroke="black" cx="52" cy="-90" rx="51.99" ry="18"/><text text-anchor="middle" x="52" y="-86.3" font-family="Times,serif" font-size="14.00">Approval</text></g><!-- Assignments&#45;&gt;Approval --><g id="edge2" class="edge"><title>Assignments&#45;&gt;Approval</title><path fill="none" stroke="black" d="M103.12,-144.41C94.69,-135.61 84.18,-124.63 74.89,-114.92"/><polygon fill="black" stroke="black" points="77.2,-112.27 67.76,-107.47 72.15,-117.11 77.2,-112.27"/></g><!-- Escalation --><g id="node5" class="node"><title>Escalation</title><ellipse fill="none" stroke="black" cx="187" cy="-90" rx="59.29" ry="18"/><text text-anchor="middle" x="187" y="-86.3" font-family="Times,serif" font-size="14.00">Escalation</text></g><!-- Assignments&#45;&gt;Escalation --><g id="edge4" class="edge"><title>Assignments&#45;&gt;Escalation</title><path fill="none" stroke="black" d="M135.11,-144.41C143.66,-135.61 154.33,-124.63 163.76,-114.92"/><polygon fill="black" stroke="black" points="166.54,-117.08 171,-107.47 161.52,-112.2 166.54,-117.08"/></g><!-- Finality --><g id="node4" class="node"><title>Finality</title><ellipse fill="none" stroke="black" cx="49" cy="-18" rx="46.29" ry="18"/><text text-anchor="middle" x="49" y="-14.3" font-family="Times,serif" font-size="14.00">Finality</text></g><!-- Approval&#45;&gt;Finality --><g id="edge3" class="edge"><title>Approval&#45;&gt;Finality</title><path fill="none" stroke="black" d="M51.25,-71.7C50.92,-63.98 50.53,-54.71 50.16,-46.11"/><polygon fill="black" stroke="black" points="53.65,-45.95 49.73,-36.1 46.66,-46.25 53.65,-45.95"/></g><!-- Consequences --><g id="node6" class="node"><title>Consequences</title><ellipse fill="none" stroke="black" cx="190" cy="-18" rx="77.19" ry="18"/><text text-anchor="middle" x="190" y="-14.3" font-family="Times,serif" font-size="14.00">Consequences</text></g><!-- Escalation&#45;&gt;Consequences --><g id="edge5" class="edge"><title>Escalation&#45;&gt;Consequences</title><path fill="none" stroke="black" d="M187.74,-71.7C188.07,-63.98 188.46,-54.71 188.83,-46.11"/><polygon fill="black" stroke="black" points="192.33,-46.25 189.26,-36.1 185.34,-45.95 192.33,-46.25"/></g></g></svg></div>
<p>审批大致有两个部分：</p>
<ul>
<li>
<p><strong>分配</strong> 决定了哪些验证者对哪些候选人进行批准检查。它确保每个候选人收到足够的随机检查器，同时减少对手获得足够检查器的几率，并限制对手的预知能力。它跟踪批准投票，以识别 &quot;不显示&quot; 批准检查所需的可疑时间，也许表明该节点正在受到攻击，并在这种情况下分配更多的检查。它跟踪中继链的等价交换，以确定对手何时可能获得关于分配的预知，并在这种情况下增加额外的检查。</p>
</li>
<li>
<p><strong>批准检查</strong> 监听分配子系统发出的分配通知，我们应检查特定的候选人。然后，它通过首先调用重建子系统来获得候选人，其次在候选人身上调用候选人有效性子系统来执行这些检查，最后发出批准投票，或者可能启动一个争议。</p>
</li>
</ul>
<p>这两个协议首先作为链外共识协议运行，使用所有验证者之间的 gossip 的 信息，其次作为这个链外协议的事后进度的链上记录。我们需要链上协议来为链下协议提供奖励。</p>
<p>审批需要两种 gossip 消息类型，即由其分配子系统创建的分配通知，以及由我们的审批检查子系统在得到候选人有效性效用子系统授权后发送的审批投票。</p>
<h2 id="审批密钥"><a class="header" href="#审批密钥">审批密钥</a></h2>
<p>我们需要为审批子系统提供两个单独的密钥：</p>
<ul>
<li>
<p><strong>审批分配密钥</strong> 是仅用于分配标准 VRF 的 sr25519/schnorrkel 密钥。我们通过在 VRF 的额外消息中包括其中继链上下文和额外数据，隐含地用批准分配密钥签署分配通知，但将这些从其 VRF 输入中排除。</p>
</li>
<li>
<p><strong>审批投票密钥</strong> 将只签署候选人的 parablock 有效性，没有自然的密钥类型限制。这没有必要实际体现一个新的会话密钥类型。我们只是想在分配和批准之间做出区分，尽管遥远的未来的节点配置可能有利于单独的角色。我们重新使用与实践中用于 parachain 支持的相同的密钥。</p>
</li>
</ul>
<p>审批投票密钥可以比较容易地由一些加固的签名者工具来处理，也许甚至是 HSM，假设我们为审批投票钥匙选择 ed25519。审批分配键可能支持也可能不支持加固的签名人工具，但这样做听起来要复杂得多。事实上，分配密钥只决定了决定审批检查器分配的 VRF 输出，对于这些输出，他们只能采取行动或不采取行动，所以他们不能含糊其辞、撒谎等，对验证器操作者来说，如果有惩罚的风险，也是很少的。</p>
<p>在未来，我们将确定在几种加固技术中，哪一种对整个网络最有利。我们可以为验证者提供一个多进程多机器的架构，也许甚至让人想起 GNUNet，或者更像智能 HSM 工具。我们可能反而会设计一个更像完整系统的系统，比如像 Cosmos 的哨兵节点。在任何一种情况下，审批分配可能由一个稍微加固的机器处理，但不一定像审批投票那样加固，但批准投票机器必须同样运行外国 WASM 代码，这增加了他们的风险，所以分配听起来是有帮助的。</p>
<h2 id="分配"><a class="header" href="#分配">分配</a></h2>
<p>审批分配决定了每个验证者对哪些候选中继链块进行审批检查。一个审批环节只考虑一个中继链块，并且只分配中继链块宣布可用的那些候选人。</p>
<p>分配要兼顾几个方面：</p>
<ul>
<li>限制对手对任务的预知性。</li>
<li>确保有足够的检查者，并且</li>
<li>相对公平地分配任务。</li>
</ul>
<p>受托人决定自己的任务，使用两到三个任务标准检查特定的候选人。在相关之前，受托人从不透露他们的分配，流言蜚语延迟了提前发送的分配，这限制了其他人的预知性。受托人只通过中继链块了解他们的分配。</p>
<p>所有标准都要求验证者使用他们的 VRF 秘钥评估一个可验证的随机函数（VRF）。所有的标准都输入关于会话的中继链块的特定数据，称为 &quot;故事&quot;，并输出要检查的候选者和称为 <code>DelayTranche</code> 的优先次序。</p>
<p>当然，当他们的候选人变得可用时，我们会解放可用的核心，但有一个批准分配标准继续将每个候选人与它在可用时占据的核心号码联系起来。</p>
<p>分配在由这个<code>DelayTranche</code>决定的松散的时间回合中进行，假设半秒的闲话时间，其进行速度大约是六秒块生产的 12 倍。如果在我们到达第<code>t</code>轮时，候选人<code>C</code>需要更多的批准检查员，那么任何在延迟批次<code>t</code>中对<code>C</code>有任务的验证者都会说闲话，为<code>C</code>发送任务通知。我们继续下去，直到所有候选人都有足够的批准检查员被分配。如果我们还没有足够的核对器，我们就把整个批次的核对器放在一起，所以我们期望严格地超过足够的核对器。如果有些核对人返回他们的批准票的速度太慢，我们也会采取较晚的批次（见下文没有显示）。</p>
<p>分配确保验证者检查那些他们有延迟档零又有最高优先权的中继链块，所以对手总是面对与延迟档零的预期分配数量相等的诚实检查者。</p>
<p>在这些标准中，BABE VRF 输出为两个标准提供了故事，它减少了对手可以定位自己的检查器的频率。我们有一个标准，其故事由候选人的区块哈希值和外部知识组成，即中继链等价物存在一个冲突的候选人。当对手通过在中继链区块生产中的等价交换获得对另外两个人的预知时，它提供了不可预见的分配。</p>
<h2 id="公告通知"><a class="header" href="#公告通知">公告/通知</a></h2>
<p>我们在节点之间 gossip 分配通知，以便所有验证者知道哪些验证者应该检查每个候选人，以及任何候选人是否需要更多的验证者。</p>
<p>分配通知包括一个由区块哈希值给出的中继链上下文、一个分配标准（由标准标识符和可选的标准特定字段组成）、一个受托人标识符和受托人的 VRF 签名，其本身由一个 VRF 预输出和一个 DLEQ 证明组成。它的 VRF 输入由标准组成，通常包括一个特定的标准字段，以及一个关于其中继链上下文块的 &quot;故事&quot;。</p>
<p>我们从不在包含分配通知的 gossip 消息中包含故事，而是要求每个验证者重建它们。我们在争端过程中从不关心分配，所以这不会使远程争端复杂化。</p>
<p>在 Schnorr VRF 中，有一个与此输入不同的额外的签名信息，我们将其设置为中继链块散列。因此，分配通知是自签名的，并且可以在没有额外签名的情况下 &quot;礼貌地&quot; gossip，也就是说，在能够从中继链上下文计算出故事的节点之间。换句话说，如果我们不能计算出一个分配通知的 VRF 部分所要求的故事，那么我们的自签名属性就会失效，我们就不能验证它的来源。我们可以通过另一个签名层（64 字节）或包括从故事中计算出来的 VRF 输入点（32 字节）来解决这个问题，但这样做似乎没有什么用处。</p>
<p>任何验证者都可以过早地发送他们的分配通知和/或批准投票。我们提前 gossip 批准票，因为它们代表了验证者的一个重要承诺。然而，我们推迟发送分配通知，直到它们与我们的本地时钟一致。我们还规定了一个礼貌性条件，即接收者知道分配通知所使用的中继链上下文。</p>
<h2 id="故事"><a class="header" href="#故事">故事</a></h2>
<p>我们根据关于中继链区块<code>R</code>的两个可能的 &quot;故事&quot; 来制定分配标准，其中包括候选人又称宣布候选人可用。所有的故事都有一个输出，试图最小化对抗性影响，然后作为分配标准的 VRF 输入。</p>
<p>我们首先有一个<code>RelayVRFStory</code>，它从中继链块生产者在创建<code>R</code>时产生的另一个 VRF 输出中输出随机性。在诚实的节点中，只有这一个创建<code>R</code>的中继链块生产者事先知道这个故事，甚至他们在两个纪元前也一无所知。</p>
<p>在 BABE 中，我们创建这个值时，调用<code>schnorrkel::vrf::VRFInOut::make_bytes</code>，上下文为 &quot;A&amp;V RC-VRF&quot;，<code>VRFInOut</code>来自授权生产一级区块的 VRF，否则来自二级区块类型的 VRF。</p>
<p>在 Sassafras 中，我们将始终使用非匿名的回收 VRF 输出，而不是授权区块生产的匿名环形 VRF。我们目前不知道 Sassafras 是否会有一个单独的 schnorrkel 密钥，但如果它重复使用其环形 VRF 密钥，有一个等价的<code>ring_vrf::VRFInOut::make_bytes</code>。</p>
<p>我们喜欢<code>RelayVRFStory</code>允许相对较少的选择，但在中继链区块生产中含糊其辞的对手可能会过早地了解依赖于<code>RelayVRFStory</code>的分配，因为同一个中继链 VRF 出现在多个区块中。</p>
<p>因此，我们提供了一个次要的<code>RelayEquivocationStory</code>，它输出候选人的区块哈希值，但只针对候选人的等价交换。当存在另一个中继链区块<code>R1</code>时，我们说<code>R</code>中的候选人<code>C</code>是一个等价物，即<code>R</code>和<code>R1</code>具有相同的<code>RelayVRFStory</code>，但<code>R</code>包含<code>C</code>，<code>R1</code>不包含<code>C</code>。</p>
<p>我们也想要检查位于我们首选的中继链之外的候选等价物，这代表了分配模块的一个稍微不同的用法，并且可能需要 gossip 消息中的更多信息。</p>
<h2 id="分配标准"><a class="header" href="#分配标准">分配标准</a></h2>
<p>分配标准使用故事和验证人的密钥批准分配密钥来计算实际分配。分配标准输出一个<code>Position</code>，包括要检查的<code>ParaId</code>，以及分配生效时的优先级<code>DelayTranche</code>。</p>
<p>赋值标准有三种类型：<code>RelayVRFModulo</code>、<code>RelayVRFDelay</code>和<code>RelayEquivocation</code>。其中，<code>RelayVRFModulo</code>和<code>RelayVRFDelay</code>都运行一个 VRF，其输入是<code>RelayVRFStory</code>的输出，而<code>RelayEquivocation</code>运行一个 VRF，其输入是<code>RelayEquivocationStory</code>的输出。</p>
<p>其中，我们有两个不同的 VRF 输出计算。</p>
<p><code>RelayVRFModulo</code>运行几个不同的样本，其 VRF 输入是<code>RelayVRFStory</code>和样本号。它用<code>schnorrkel::vrf::VRFInOut::make_bytes</code>计算 VRF 输出，使用 &quot;A&amp;V 核心 &quot;的上下文，将这个数字与可用核心的数量相乘，并输出刚刚被宣布为可用的候选人，并由 aka 离开该可用核心包括。我们放弃任何没有返回候选人的样本，因为在这个中继链块中没有候选人离开采样的可用性核心。我们最初选择三个样本，但我们可以通过增加到四个或五个样本，并相应地减少支持检查来使 polkadot 更加安全和高效。所有成功的`RelayVRFModulo'样本都被分配到延迟档位 0。</p>
<p><code>RelayVRFDelay</code>和<code>RelayEquivocation</code>没有采样过程。相反，我们在特定的候选人上运行它们，它们从其 VRF 输出中计算延迟。 <code>RelayVRFDelay'对包括在中继链块下的所有候选者运行，也就是宣布可用，并通过</code>RelayVRFStory'输入相关 VRF 输出。 <code>RelayEquivocation</code>只对候选区块等值运行，并通过<code>RelayEquivocation</code>故事输入其区块散列值。</p>
<p><code>RelayVRFDelay</code>和<code>RelayEquivocation</code>都使用<code>schnorrkel::vrf::VRFInOut::make_bytes</code>计算它们的输出，使用上下文 &quot;A&amp;V Tranche&quot;，并将结果按<code>num_delay_tranches + zeroth_delay_tranche_width</code>的方式减少，并将结果 0 到<code>zeroth_delay_tranche_width</code>合并为 0。通过这种方式，他们确保了 zeroth 延迟段的<code>zeroth_delay_tranche_width+1</code>倍于任何其他段的分配数。</p>
<p>作为未来的工作（或 TODO？），我们应该使用<code>vrf_merge</code>合并具有相同延迟和故事的分配通知。我们不能合并那些具有相同延迟和不同故事的通知，因为<code>RelayEquivocationStory</code>可能会改变，但<code>RelayVRFStory</code>永远不会改变。</p>
<h2 id="播音员和观察者跟踪者"><a class="header" href="#播音员和观察者跟踪者">播音员和观察者/跟踪者</a></h2>
<p>我们跟踪所有验证人对每个中继链区块相关的候选人宣布的批准分配，这告诉我们哪些验证人被分配给哪些候选人。</p>
<p>我们允许每个验证人在每个故事中最多为每个候选人分配一次任务，因此一个验证人可以在 &quot;RelayVRFDelay&quot;和 &quot;RelayEquivocation&quot;标准下被分配，但不能在 &quot;RelayVRFModulo&quot;和 &quot;RelayVRFDelay&quot;标准下分配，因为它们都使用同一个故事。我们只允许每个审定者对每个候选人投一次批准票，这对任何适用的标准都是有意义的。</p>
<p>我们宣布，并开始检查我们自己的任务，当其批次的延迟达到时，但只有当跟踪器说受让人候选人需要更多的批准检查者。我们从不宣布我们认为不必要的任务，因为早期宣布会给对手带来信息。所有延迟批零的分配总是被宣布，这包括所有<code>RelayVRFModulo</code>分配。</p>
<p>换句话说，如果某个候选者<code>C</code>在我们到达第<code>t</code>轮时需要更多的批准检查者，那么任何在延迟档<code>t</code>中对<code>C</code>有任务的验证者都会散布他们对<code>C</code>的任务通知，并开始重建和验证<code>C</code>。然而，如果<code>C</code>达到了足够的分配，那么后来有分配的验证者就跳过宣布他们的分配。</p>
<p>我们继续下去，直到所有候选人都有足够的批准检查员被分配。我们从不在批次内对任务进行优先排序，并将某一批次的所有任务或未分配的任务放在一起计算，所以我们经常会超额完成分配的批准检查员的目标数量。</p>
<h3 id="不显示"><a class="header" href="#不显示">不显示</a></h3>
<p>我们有一个 &quot;不显示&quot; 的超时时间，比一个中继链槽长，所以至少 6 秒，在此期间，我们希望批准检查应该成功地重建候选区块，重做其擦除编码以检查候选接收，最后重新检查候选区块本身。</p>
<p>如果验证者在我们收到他们的任务通知后，在这个 &quot;不显示&quot; 的时间内没有批准或提出异议，我们就认为他们是 &quot;不显示&quot;。我们从收到他们的任务通知开始计时，而不是从我们想象中的实际时间开始计时，因为否则的话，收到迟到的任务通知就会立即产生 &quot;不显示 &quot;和不必要的工作。</p>
<p>我们担心 &quot;不显示&quot; 代表验证器受到了拒绝服务攻击，可能是为了防止它重建候选人，但也可能是为了延迟它对争端的 gossip。因此，我们总是通过增加一整批额外的延迟验证器来取代 &quot;不显示&quot;，所以这种攻击总是导致额外的验证器。</p>
<p>举个例子，假设我们需要 20 个验证人，但第 0 档只产生 14 个，第 1 档只产生 4 个，那么我们从第 2 档拿走所有 5 个，因此该候选人需要 23 个验证人。如果第一组或第二组的检查员查理在 8 秒内没有反应，那么我们就从第三组中加入所有 7 名检查员。如果第三组中的一个检查员 Cindy 在 8 秒内没有反应，那么我们就从第四组中抽取全部 3 个检查员。我们现在有 33 个检查员在对候选人进行检查，所以这个过程升级得很快。</p>
<p>我们之所以升级得这么快，是因为我们担心查理和辛迪可能是分配给该候选人的唯一诚实的检查员。因此，如果查理或辛迪最终返回批准，那么我们就可以得出批准的结论，并放弃第四批的检查员。</p>
<p>因此，我们要求 &quot;不显示&quot; 的超时时间要比中继链的时间长，这样我们就可以在链上见证 &quot;不显示&quot;。我们将在下面讨论这如何有助于奖励取代 &quot;不显示&quot; 的验证者。</p>
<p>我们避免对 &quot;不显示&quot; 本身进行削减，尽管 &quot;不显示&quot; 可能会进入一些惩罚重复不良表现的计算，可能会取代`ImOnline'，我们可以减少他们的奖励并进一步奖励那些填写的人。</p>
<p>作为未来的工作，我们可以预见扩大 &quot;不露面 &quot;的方案，使额外的检查者匿名，比如通过使用分配注意到一个新的标准，采用环形 VRF，然后所有验证者通过请求几个擦除编码的碎片来提供掩护，但这样的匿名方案听起来非常复杂，远远超出我们最初的功能。</p>
<h2 id="分配推迟"><a class="header" href="#分配推迟">分配推迟</a></h2>
<p>我们希望验证者在随机获得过多的任务时，偶尔会超载。所有这些波动都会在多个区块中得到很好的摊销，但这就会减慢最终结果。</p>
<p>因此，我们允许验证者故意推迟发送他们的任务。如果没有人知道他们的任务，那么他们就会避免产生 &quot;不显示&quot; 的情况，而且工作量会正常进行。</p>
<p>我们强烈希望延期来自于比零更重要的批次，因为零批次的检查在一定程度上提供了更多的安全性。</p>
<p>TODO：什么时候？这对网络来说是最好的吗？</p>
<h2 id="链上验证"><a class="header" href="#链上验证">链上验证</a></h2>
<p>我们应该在链上验证批准，以奖励批准检查者。因此，我们要求 &quot;不显示&quot; 的超时时间比中继链槽长，这样我们就可以在链上见证 &quot;不显示&quot;，这有助于实现这一目标。链上记录链下过程的主要挑战是对抗性区块生产者，他们可能会审查投票或向链上发布投票，导致其他投票被忽略和不被奖励（奖励偷窃）。</p>
<p>原则上，所有验证者都有一些 &quot;档次&quot;，在这些档次上，他们被分配给准链上的候选人，这确保我们最终达到足够的验证者。如上所述，当缓慢的验证者最终出现时，我们经常收回 &quot;不显示&quot;，所以见证他们最初是 &quot;不显示&quot; 有助于管理奖励。</p>
<p>我们希望链上验证应该分两个阶段进行。我们首先在中继链区块中记录分配通知和批准投票，在区块验证中再次进行 VRF 或常规签名验证，并在中继链状态中插入链上验证的无签名说明，其中包含每个分配通知的验证人、批次、准绳和中继区块高度。然后，我们后来有另一个中继链块，运行一些 &quot;批准的&quot;内在的，它从状态中提取所有这些笔记，并将它们输入我们的批准代码。</p>
<p>我们现在在推迟和链上验证之间的互动中遇到了一个利基关注。任何拥有零档（或其他低档）分配的验证者可以延迟发送分配通知，比如因为他们推迟了他们的分配档（这是允许的）。如果他们后来在决赛时间前后发送了这个分配通知，那么他们就与这个批准的比赛。本质上：如果他们的公告得到链上（也允许），那么是的，它推迟了决赛。如果它没有上链，那么是的，我们有一个公告，链外的共识系统说是有效的，但链上的人因为太慢而忽略了。</p>
<p>在这种情况下，我们需要链上的人获胜，但这样做需要对最终结果施加一个令人厌恶的漫长的总体延迟。我们也可以探索对推迟的限制，但这听起来更难。</p>
<h2 id="参数"><a class="header" href="#参数">参数</a></h2>
<p>我们倾向于在 <code>RelayVRFModulo</code> 下进行审批检查员的分配，而不是 <code>RelayVRFDelay</code>，因为 <code>RelayVRFModulo</code> 可以避免给单个检查员太多的分配，而且零档分配最有利于安全。我们建议在<code>RelayVRFModulo</code>下至少分配 16 个检查员，尽管分配水平从未被正确分析过。</p>
<p>我们的延迟标准<code>RelayVRFDelay</code>和<code>RelayEquivocation</code>都有两个主要参数，即每档预期检查器和零延迟档宽度。</p>
<p>我们要求每批的预期检查者少于 3 个，因为否则一个拥有 1/3 利益的对手可以强迫所有节点检查所有的块。我们强烈建议每批的预期检查者少于两个，这有助于避免意外的和故意的爆炸。我们还建议每档的预期检查器大于 1，这有助于防止攻击者预测比推进一档只增加他们自己的验证器。</p>
<p>我们通过零档分配来提高安全性，所以<code>RelayEquivocation</code>应该将其前几个档合并到零档。我们将其描述为零延迟段的宽度，最初我们将<code>RelayEquivocation</code>设置为 12，<code>RelayVRFDelay</code>设置为 1。</p>
<h2 id="为什么用-vrfs"><a class="header" href="#为什么用-vrfs">为什么用 VRFs?</a></h2>
<p>我们用 VRF 做分配，是为了给 &quot;足够多的&quot; 检查者一些意义，而不仅仅是 &quot;预期&quot; 检查者。</p>
<p>我们可以指定一个只使用系统随机性的协议，这很有效，因为我们最强的防御是预期的分配自己的诚实检查员的数量。在这种情况下，对手可以轻而易举地用他们自己的检查员淹没他们自己的区块，所以这个强大的防御成为我们唯一的防御，延迟分批变得毫无用处，所以一些区块实际上有零个批准检查员，可能总体上只有一个检查员。</p>
<p>虽然 VRFs 要求对手在这种攻击之间等待的时间要长得多，这也有助于对付那些没有什么利害关系的对手，因为他们破坏了验证器。VRFs 提高了用户的信心，即没有发生这种 &quot;驱赶&quot;攻击，因为延迟付款系统至少确保了一些最低数量的批准检查者。在这种情况下，VRFs 允许减少支持检查和增加批准检查，这使 polkadot 更有效率。</p>
<h2 id="gossip"><a class="header" href="#gossip">Gossip</a></h2>
<p>任何验证人都可能过早地发送他们的任务通知和/或批准票。我们对批准票进行gossip，因为它们代表了验证人的一个重要承诺。我们保留但推迟gossip分配通知，直到它们与我们的本地时钟一致。</p>
<p>过早地 gossip 分配通知可能会产生一个拒绝服务的载体。如果是这样的话，我们可能会利用使我们的时钟同步的相对时间方案，可以想象它允许放弃过早的分配。</p>
<h2 id="最终性-grandpa-投票规则"><a class="header" href="#最终性-grandpa-投票规则">最终性 GRANDPA 投票规则</a></h2>
<p>中继链要求验证者参与 GRANDPA。在 GRANDPA 中，验证者就他们认为是链上最好的区块提交链外投票，GRANDPA 决定由超级多数的子链所包含的共同区块。根据前几轮投票的结果，对可以提交的内容也有额外的限制。</p>
<p>为了避免最终确定任何没有收到足够的批准票或有争议的东西，我们将把批准协议与对 GRANDPA 投票策略的改变结合起来，使诚实的节点只对其中的每个准链候选人都被批准的链进行投票。此外，该投票规则防止对存在任何现场争议或任何争议已解决的候选人无效的链进行投票。</p>
<p>因此，最终确定的中继链应该只包含大多数人认为其中的每一个区块都得到了充分的批准的中继链区块。</p>
<h3 id="未来工作"><a class="header" href="#未来工作">未来工作</a></h3>
<p>我们可以考虑额外的 gossip 消息，节点声称 &quot;缓慢的可用性&quot;和/或 &quot;缓慢的候选&quot;，以微调任务的 &quot;不显示&quot; 系统，但足够长的 &quot;不显示&quot; 延迟可能就足够了。</p>
<p>一旦可用性系统使用直接的 UDP 连接工作，我们将在 UDP 方面发展更多的实践经验。在这一点上，我们应该发现重建是否在完整的图中表现得足够好或
从拓扑结构的限制中获益。在这一点上，一个分配通知可以隐含地从一个随机的 1/3 中请求碎片，也许是拓扑结构的限制，这可以节省一个闲话轮。如果这种初步的快速重建失败了，那么节点就直接请求替代的棋子。这与 &quot;慢速可用性&quot;的要求重叠，有一个有趣的设计空间。</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议程序"><a class="header" href="#争议程序">争议程序</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议工作流"><a class="header" href="#争议工作流">争议工作流</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="链选择和最终化"><a class="header" href="#链选择和最终化">链选择和最终化</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="架构概览"><a class="header" href="#架构概览">架构概览</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="消息概览"><a class="header" href="#消息概览">消息概览</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pvf-预检测"><a class="header" href="#pvf-预检测">PVF 预检测</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="运行时架构"><a class="header" href="#运行时架构">运行时架构</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="initializer-模块"><a class="header" href="#initializer-模块">Initializer 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration-模块"><a class="header" href="#configuration-模块">Configuration 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="shared-模块"><a class="header" href="#shared-模块">Shared 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="disputes-模块"><a class="header" href="#disputes-模块">Disputes 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="paras-模块"><a class="header" href="#paras-模块">Paras 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scheduler-模块"><a class="header" href="#scheduler-模块">Scheduler 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inclusion-模块"><a class="header" href="#inclusion-模块">Inclusion 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parainherent-模块"><a class="header" href="#parainherent-模块">ParaInherent 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dmp-模块"><a class="header" href="#dmp-模块">DMP 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ump-模块"><a class="header" href="#ump-模块">UMP 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hrmp-模块"><a class="header" href="#hrmp-模块">HRMP 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="session-info-模块"><a class="header" href="#session-info-模块">Session Info 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="运行时-apis"><a class="header" href="#运行时-apis">运行时 APIs</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="验证人"><a class="header" href="#验证人">验证人</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="验证人-groups"><a class="header" href="#验证人-groups">验证人 Groups</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="可用性核心"><a class="header" href="#可用性核心">可用性核心</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="持久性验证数据"><a class="header" href="#持久性验证数据">持久性验证数据</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="session-索引"><a class="header" href="#session-索引">Session 索引</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="验证代码"><a class="header" href="#验证代码">验证代码</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="候选待定可用性"><a class="header" href="#候选待定可用性">候选待定可用性</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="候选者事件"><a class="header" href="#候选者事件">候选者事件</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议信息"><a class="header" href="#争议信息">争议信息</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="包含的候选者"><a class="header" href="#包含的候选者">包含的候选者</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pvf-预检查"><a class="header" href="#pvf-预检查">PVF 预检查</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="节点架构"><a class="header" href="#节点架构">节点架构</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="子系统和工作"><a class="header" href="#子系统和工作">子系统和工作</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="监督员"><a class="header" href="#监督员">监督员</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="grandpa-投票规则"><a class="header" href="#grandpa-投票规则">GRANDPA 投票规则</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="收集人子系统"><a class="header" href="#收集人子系统">收集人子系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="收集人产生"><a class="header" href="#收集人产生">收集人产生</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="收集人协议"><a class="header" href="#收集人协议">收集人协议</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="支持子系统"><a class="header" href="#支持子系统">支持子系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="候选者支持"><a class="header" href="#候选者支持">候选者支持</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="报表分发"><a class="header" href="#报表分发">报表分发</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="可用性子系统"><a class="header" href="#可用性子系统">可用性子系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="可用性分发"><a class="header" href="#可用性分发">可用性分发</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="可用性恢复"><a class="header" href="#可用性恢复">可用性恢复</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bitfield-分发"><a class="header" href="#bitfield-分发">Bitfield 分发</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bitfield-签名"><a class="header" href="#bitfield-签名">Bitfield 签名</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="审批子系统"><a class="header" href="#审批子系统">审批子系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="审批投票"><a class="header" href="#审批投票">审批投票</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="审批分发"><a class="header" href="#审批分发">审批分发</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议子系统"><a class="header" href="#争议子系统">争议子系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议协调员"><a class="header" href="#争议协调员">争议协调员</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议分发"><a class="header" href="#争议分发">争议分发</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="实用工具子系统"><a class="header" href="#实用工具子系统">实用工具子系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="可用性商店"><a class="header" href="#可用性商店">可用性商店</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="候选人验证"><a class="header" href="#候选人验证">候选人验证</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="提供者"><a class="header" href="#提供者">提供者</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="网络桥"><a class="header" href="#网络桥">网络桥</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gossip-支持"><a class="header" href="#gossip-支持">Gossip 支持</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="不良行为仲裁"><a class="header" href="#不良行为仲裁">不良行为仲裁</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="对等集合管理员"><a class="header" href="#对等集合管理员">对等集合管理员</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="运行时-api-请求"><a class="header" href="#运行时-api-请求">运行时 API 请求</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="链-api-请求"><a class="header" href="#链-api-请求">链 API 请求</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="链选择请求"><a class="header" href="#链选择请求">链选择请求</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pvf-预检查-1"><a class="header" href="#pvf-预检查-1">PVF 预检查</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="数据结构和类型"><a class="header" href="#数据结构和类型">数据结构和类型</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="候选人"><a class="header" href="#候选人">候选人</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="支持"><a class="header" href="#支持">支持</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="可用性"><a class="header" href="#可用性">可用性</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="监督员和子系统协议"><a class="header" href="#监督员和子系统协议">监督员和子系统协议</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="运行时"><a class="header" href="#运行时">运行时</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="链"><a class="header" href="#链">链</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="消息"><a class="header" href="#消息">消息</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="网络"><a class="header" href="#网络">网络</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="审批"><a class="header" href="#审批">审批</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议"><a class="header" href="#争议">争议</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pvf-预检查-2"><a class="header" href="#pvf-预检查-2">PVF 预检查</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="术语"><a class="header" href="#术语">术语</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="进一步阅读"><a class="header" href="#进一步阅读">进一步阅读</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="mermaid.min.js"></script>
        <script type="text/javascript" src="mermaid-init.js"></script>

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
