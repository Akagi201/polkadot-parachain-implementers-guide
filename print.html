<!DOCTYPE HTML>
<html lang="zh-CN" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Polkadot 平行链实现指南</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="index.html">前言</a></li><li class="chapter-item expanded "><a href="whence-parachains.html"><strong aria-hidden="true">1.</strong> 平行链从何而来</a></li><li class="chapter-item expanded "><a href="protocol-overview.html"><strong aria-hidden="true">2.</strong> 协议概览</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="protocol-approval.html"><strong aria-hidden="true">2.1.</strong> 审批流程</a></li><li class="chapter-item expanded "><a href="protocol-disputes.html"><strong aria-hidden="true">2.2.</strong> 争议流程</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="disputes-flow.html"><strong aria-hidden="true">2.2.1.</strong> 争议工作流</a></li></ol></li><li class="chapter-item expanded "><a href="protocol-chain-selection.html"><strong aria-hidden="true">2.3.</strong> 链选择和最终化</a></li></ol></li><li class="chapter-item expanded "><a href="architecture.html"><strong aria-hidden="true">3.</strong> 架构概览</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="messaging.html"><strong aria-hidden="true">3.1.</strong> 消息概览</a></li><li class="chapter-item expanded "><a href="pvf-prechecking.html"><strong aria-hidden="true">3.2.</strong> PVF 预检测</a></li></ol></li><li class="chapter-item expanded "><a href="runtime/index.html"><strong aria-hidden="true">4.</strong> 运行时架构</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="runtime/initializer.html"><strong aria-hidden="true">4.1.</strong> Initializer 模块</a></li><li class="chapter-item expanded "><a href="runtime/configuration.html"><strong aria-hidden="true">4.2.</strong> Configuration 模块</a></li><li class="chapter-item expanded "><a href="runtime/shared.html"><strong aria-hidden="true">4.3.</strong> Shared 模块</a></li><li class="chapter-item expanded "><a href="runtime/disputes.html"><strong aria-hidden="true">4.4.</strong> Disputes 模块</a></li><li class="chapter-item expanded "><a href="runtime/paras.html"><strong aria-hidden="true">4.5.</strong> Paras 模块</a></li><li class="chapter-item expanded "><a href="runtime/scheduler.html"><strong aria-hidden="true">4.6.</strong> Scheduler 模块</a></li><li class="chapter-item expanded "><a href="runtime/inclusion.html"><strong aria-hidden="true">4.7.</strong> Inclusion 模块</a></li><li class="chapter-item expanded "><a href="runtime/parainherent.html"><strong aria-hidden="true">4.8.</strong> ParaInherent 模块</a></li><li class="chapter-item expanded "><a href="runtime/dmp.html"><strong aria-hidden="true">4.9.</strong> DMP 模块</a></li><li class="chapter-item expanded "><a href="runtime/ump.html"><strong aria-hidden="true">4.10.</strong> UMP 模块</a></li><li class="chapter-item expanded "><a href="runtime/hrmp.html"><strong aria-hidden="true">4.11.</strong> HRMP 模块</a></li><li class="chapter-item expanded "><a href="runtime/session_info.html"><strong aria-hidden="true">4.12.</strong> Session Info 模块</a></li></ol></li><li class="chapter-item expanded "><a href="runtime-api/index.html"><strong aria-hidden="true">5.</strong> 运行时 APIs</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="runtime-api/validators.html"><strong aria-hidden="true">5.1.</strong> 验证人</a></li><li class="chapter-item expanded "><a href="runtime-api/validator-groups.html"><strong aria-hidden="true">5.2.</strong> 验证人 Groups</a></li><li class="chapter-item expanded "><a href="runtime-api/availability-cores.html"><strong aria-hidden="true">5.3.</strong> 可用性核心</a></li><li class="chapter-item expanded "><a href="runtime-api/persisted-validation-data.html"><strong aria-hidden="true">5.4.</strong> 持久性验证数据</a></li><li class="chapter-item expanded "><a href="runtime-api/session-index.html"><strong aria-hidden="true">5.5.</strong> Session 索引</a></li><li class="chapter-item expanded "><a href="runtime-api/validation-code.html"><strong aria-hidden="true">5.6.</strong> 验证代码</a></li><li class="chapter-item expanded "><a href="runtime-api/candidate-pending-availability.html"><strong aria-hidden="true">5.7.</strong> 候选待定可用性</a></li><li class="chapter-item expanded "><a href="runtime-api/candidate-events.html"><strong aria-hidden="true">5.8.</strong> 候选者事件</a></li><li class="chapter-item expanded "><a href="runtime-api/disputes-info.html"><strong aria-hidden="true">5.9.</strong> 争议信息</a></li><li class="chapter-item expanded "><a href="runtime-api/candidates-included.html"><strong aria-hidden="true">5.10.</strong> 包含的候选者</a></li><li class="chapter-item expanded "><a href="runtime-api/pvf-prechecking.html"><strong aria-hidden="true">5.11.</strong> PVF 预检查</a></li></ol></li><li class="chapter-item expanded "><a href="node/index.html"><strong aria-hidden="true">6.</strong> 节点架构</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/subsystems-and-jobs.html"><strong aria-hidden="true">6.1.</strong> 子系统和工作</a></li><li class="chapter-item expanded "><a href="node/overseer.html"><strong aria-hidden="true">6.2.</strong> 监督员</a></li><li class="chapter-item expanded "><a href="node/grandpa-voting-rule.html"><strong aria-hidden="true">6.3.</strong> GRANDPA 投票规则</a></li><li class="chapter-item expanded "><a href="node/collators/index.html"><strong aria-hidden="true">6.4.</strong> 收集人子系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/collators/collation-generation.html"><strong aria-hidden="true">6.4.1.</strong> 收集人产生</a></li><li class="chapter-item expanded "><a href="node/collators/collator-protocol.html"><strong aria-hidden="true">6.4.2.</strong> 收集人协议</a></li></ol></li><li class="chapter-item expanded "><a href="node/backing/index.html"><strong aria-hidden="true">6.5.</strong> 支持子系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/backing/candidate-backing.html"><strong aria-hidden="true">6.5.1.</strong> 候选者支持</a></li><li class="chapter-item expanded "><a href="node/backing/statement-distribution.html"><strong aria-hidden="true">6.5.2.</strong> 报表分发</a></li></ol></li><li class="chapter-item expanded "><a href="node/availability/index.html"><strong aria-hidden="true">6.6.</strong> 可用性子系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/availability/availability-distribution.html"><strong aria-hidden="true">6.6.1.</strong> 可用性分发</a></li><li class="chapter-item expanded "><a href="node/availability/availability-recovery.html"><strong aria-hidden="true">6.6.2.</strong> 可用性恢复</a></li><li class="chapter-item expanded "><a href="node/availability/bitfield-distribution.html"><strong aria-hidden="true">6.6.3.</strong> Bitfield 分发</a></li><li class="chapter-item expanded "><a href="node/availability/bitfield-signing.html"><strong aria-hidden="true">6.6.4.</strong> Bitfield 签名</a></li></ol></li><li class="chapter-item expanded "><a href="node/approval/index.html"><strong aria-hidden="true">6.7.</strong> 审批子系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/approval/approval-voting.html"><strong aria-hidden="true">6.7.1.</strong> 审批投票</a></li><li class="chapter-item expanded "><a href="node/approval/approval-distribution.html"><strong aria-hidden="true">6.7.2.</strong> 审批分发</a></li></ol></li><li class="chapter-item expanded "><a href="node/disputes/index.html"><strong aria-hidden="true">6.8.</strong> 争议子系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/disputes/dispute-coordinator.html"><strong aria-hidden="true">6.8.1.</strong> 争议协调员</a></li><li class="chapter-item expanded "><a href="node/disputes/dispute-distribution.html"><strong aria-hidden="true">6.8.2.</strong> 争议分发</a></li></ol></li><li class="chapter-item expanded "><a href="node/utility/index.html"><strong aria-hidden="true">6.9.</strong> 实用工具子系统</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="node/utility/availability-store.html"><strong aria-hidden="true">6.9.1.</strong> 可用性商店</a></li><li class="chapter-item expanded "><a href="node/utility/candidate-validation.html"><strong aria-hidden="true">6.9.2.</strong> 候选人验证</a></li><li class="chapter-item expanded "><a href="node/utility/provisioner.html"><strong aria-hidden="true">6.9.3.</strong> 提供者</a></li><li class="chapter-item expanded "><a href="node/utility/network-bridge.html"><strong aria-hidden="true">6.9.4.</strong> 网络桥</a></li><li class="chapter-item expanded "><a href="node/utility/gossip-support.html"><strong aria-hidden="true">6.9.5.</strong> Gossip 支持</a></li><li class="chapter-item expanded "><a href="node/utility/misbehavior-arbitration.html"><strong aria-hidden="true">6.9.6.</strong> 不良行为仲裁</a></li><li class="chapter-item expanded "><a href="node/utility/peer-set-manager.html"><strong aria-hidden="true">6.9.7.</strong> 对等集合管理员</a></li><li class="chapter-item expanded "><a href="node/utility/runtime-api.html"><strong aria-hidden="true">6.9.8.</strong> 运行时 API 请求</a></li><li class="chapter-item expanded "><a href="node/utility/chain-api.html"><strong aria-hidden="true">6.9.9.</strong> 链 API 请求</a></li><li class="chapter-item expanded "><a href="node/utility/chain-selection.html"><strong aria-hidden="true">6.9.10.</strong> 链选择请求</a></li><li class="chapter-item expanded "><a href="node/utility/pvf-prechecker.html"><strong aria-hidden="true">6.9.11.</strong> PVF 预检查</a></li></ol></li><li class="chapter-item expanded "><a href="types/index.html"><strong aria-hidden="true">6.10.</strong> 数据结构和类型</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="types/candidate.html"><strong aria-hidden="true">6.10.1.</strong> 候选人</a></li><li class="chapter-item expanded "><a href="types/backing.html"><strong aria-hidden="true">6.10.2.</strong> 支持</a></li><li class="chapter-item expanded "><a href="types/availability.html"><strong aria-hidden="true">6.10.3.</strong> 可用性</a></li><li class="chapter-item expanded "><a href="types/overseer-protocol.html"><strong aria-hidden="true">6.10.4.</strong> 监督员和子系统协议</a></li><li class="chapter-item expanded "><a href="types/runtime.html"><strong aria-hidden="true">6.10.5.</strong> 运行时</a></li><li class="chapter-item expanded "><a href="types/chain.html"><strong aria-hidden="true">6.10.6.</strong> 链</a></li><li class="chapter-item expanded "><a href="types/messages.html"><strong aria-hidden="true">6.10.7.</strong> 消息</a></li><li class="chapter-item expanded "><a href="types/network.html"><strong aria-hidden="true">6.10.8.</strong> 网络</a></li><li class="chapter-item expanded "><a href="types/approval.html"><strong aria-hidden="true">6.10.9.</strong> 审批</a></li><li class="chapter-item expanded "><a href="types/disputes.html"><strong aria-hidden="true">6.10.10.</strong> 争议</a></li><li class="chapter-item expanded "><a href="types/pvf-prechecking.html"><strong aria-hidden="true">6.10.11.</strong> PVF 预检查</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="glossary.html">术语</a></li><li class="chapter-item expanded affix "><a href="further-reading.html">进一步阅读</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Polkadot 平行链实现指南</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="前言"><a class="header" href="#前言">前言</a></h1>
<p>本文件旨在描述 Polkadot 的平行链的功能主机的目的、功能和实现--即为组成平行链提供安全和推进的软件。它不是为一个特定的平行链的实现者，而是为平行链主机的实现者。实际上，这是为一般的 Polkadot 的实现者准备的。</p>
<p>还有一些其他文件更详细地描述了这项研究。所有参考文件都将在此链接，并应与本文件一起阅读，以获得对全貌的最佳理解。然而，这是唯一一份旨在描述 Polkadot 特定实例的关键方面的文件，其中包括许多研究的低层次技术细节和软件架构。</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="平行链从何而来"><a class="header" href="#平行链从何而来">平行链从何而来</a></h1>
<p>平行链是问题的解决方案。就像任何解决方案一样，如果不首先了解问题，就无法理解它。因此，让我们先来看看区块链技术所面临的问题，这些问题导致我们开始探索类似于平行链的设计空间。</p>
<h2 id="问题-1-扩展性"><a class="header" href="#问题-1-扩展性">问题 1: 扩展性</a></h2>
<p>几年前，简单的工作证明（PoW）区块链，如比特币、以太坊和无数其他区块链的交易吞吐量显然太低。</p>
<blockquote>
<p>TODO: 如果有更多的区块链，等等。</p>
</blockquote>
<p>权益证明（PoS）系统可以完成比 PoW 区块链更高的吞吐量。PoS 系统是由绑定的资本而不是花费的算力来保证的--流动性机会成本与燃烧的电力。它们的工作方式是选择一组具有已知经济身份的验证者，他们锁定代币以换取 &quot;验证&quot; 或参与共识过程的权利。如果他们被发现错误地执行该过程，他们将被惩罚，这意味着部分或全部被锁定的代币将被烧毁。这提供了一个强大的抑制不当行为的方向。</p>
<p>由于共识协议不围绕着浪费算力，区块时间和协议可以更快发生。在编写区块之前，不必找到 PoW 挑战的解决方案，因此编写区块的开销被减少到只有创建和分发区块的成本。</p>
<p>然而，PoS 链上的共识需要 2/3 以上的验证者对发生在第一层的一切达成完全一致：所有的逻辑都是作为区块链的状态机的一部分进行的。这意味着每个人仍然需要检查一切。此外，验证者可能会根据他们在异步网络上收到的信息对系统有不同的看法，这使得对最新状态的共识更加困难。</p>
<p>平行链是一个<strong>分片</strong>协议的例子。分片是一个从传统数据库架构中借用的概念。我们不要求每个参与者检查每笔交易，而是要求每个参与者检查一些交易的子集，其中有足够的冗余，使那些杂乱无章的（任意恶意的）参与者不能偷偷地进入无效的交易--至少不会被发现并被惩罚，这些交易会被恢复。</p>
<p>分片和权益证明相互协调，允许一个平行链主机在许多平行链上提供完全的安全性，即使没有所有参与者检查所有的状态转换。</p>
<blockquote>
<p>TODO: 注意网络影响和桥接</p>
</blockquote>
<h2 id="问题-2-灵活性专业化"><a class="header" href="#问题-2-灵活性专业化">问题 2: 灵活性/专业化</a></h2>
<p>&quot;dumb&quot; 虚拟机并没有给你带来灵活性。任何工程师都知道，能够对一个问题进行专业化的处理会给他们和他们的用户带来更多的 <em>杠杆</em>。</p>
<blockquote>
<p>TODO: 扩展杠杆</p>
</blockquote>
<p>认识到这些问题后，我们开始寻找解决这些问题的方法，这可以让开发者创建和部署专用的区块链，统一在一个共同的安全源下，并且能够在它们之间进行消息传递；一个 <em>异质分片解决方案</em>，我们称之为<strong>平行链</strong>。</p>
<div style="break-before: page; page-break-before: always;"></div><!-- markdownlint-disable MD010 -->
<h1 id="协议概览"><a class="header" href="#协议概览">协议概览</a></h1>
<p>本节旨在高水平地描述在 Polkadot 中运行平行链所涉及的角色和协议。具体来说，我们描述了不同的行为者如何相互沟通，他们单独和集体保存什么样的数据结构，以及他们为什么要做这些事情的高级目的。</p>
<p>我们的最高目标是将一个平行链区块从编写到安全包含，并定义一个可以重复和平行进行的过程，用于许多不同的平行链，以便随着时间的推移扩展它们。理解这里所采取的高层次的方法对于进一步提供拟议的架构的背景是很重要的。与此相关的 Polkadot 的关键部分是主要的 Polkadot 区块链，被称为中继链，以及为该区块链提供安全和输入的行为者。</p>
<p>首先，有必要介绍一下我们参与这个协议的主要行为者。</p>
<ol>
<li>验证人。这些节点负责验证拟议的平行链区块。他们通过检查区块的有效性证明（PoV）来做到这一点，并确保 PoV 仍然可用。他们把金融资本作为 &quot;游戏中的皮肤&quot;，如果他们被证明是错误的验证，可以被砍掉（销毁）。</li>
<li>收集人。这些节点负责创建验证人知道如何检查的有效性证明。创建 PoV 通常需要熟悉交易格式和平行链的区块编写规则，以及能够访问平行链的全部状态。</li>
<li>渔民。这些是由用户操作的、无权限的节点，其目标是抓住行为不端的验证人以换取赏金。收集人和验证人也可以作为 &quot;渔夫&quot; 行事。渔民对于安全来说并不是必须的，而且本文也没有深入涉及。</li>
</ol>
<p>这意味着一个简单的管道，收集人向验证人发送平行链区块和其必要的 PoV 来检查。然后，验证人使用 PoV 验证区块，签署描述积极或消极结果的声明，如果有足够的积极声明，该区块可以在中继链上被注意到。负面的声明不是否决，但会导致争议，那些错误的一方会被惩罚。如果另一个验证人后来发现一个验证人或一组验证人错误地签署了一份声明，声称一个区块是有效的，那么这些验证人将被惩罚，而验证人将获得赏金。</p>
<p>然而，这种表述有一个问题。为了让另一个验证人在事后检查前一组验证人的工作，PoV 必须保持 <em>可用</em>，以便其他验证人可以获取它以检查工作。预计 PoVs 太大，无法直接包含在区块链中，所以我们需要一个替代的 <em>数据可用性</em> 方案，要求验证人证明他们工作的输入将保持可用，所以他们的工作可以被检查。经验性测试告诉我们，许多 PoV 在重载期间可能在 1 到 10MB 之间。</p>
<p>下面是对包含管道的描述：一个平行链区块（或简称 parablock）从创建到包含的路径。</p>
<ol>
<li>验证人是由验证人分配程序选择并分配给平行链的。</li>
<li>收集人产生平行链区块，它被称为平行链候选人或候选人，同时还有候选人的 PoV。</li>
<li>收集人通过收集人协议将候选人和 PoV 转发给分配给同一平行链的验证人。</li>
<li>在某一特定时间点分配到某一平行链的验证人参与到候选人支持子系统中，以验证被提出来验证的候选人。从验证人那里收集到足够多的签名有效性声明的候选人被认为是 &quot;可支持的&quot;。他们的支持是已签署的有效性声明的集合。</li>
<li>由 BABE 选择的中继链区块的作者，可以为每个平行链记下最多一个可支持的候选者，并将其与支持一起纳入中继链区块。一个可支持的候选者一旦被纳入中继链，就被认为在中继链的那个分叉中得到了支持。</li>
<li>一旦在中继链中得到支持，该平行链候选者就被认为是 &quot;待定可用性&quot;。它不被认为是作为平行链的一部分，直到它被证明是可用的。</li>
<li>在接下来的中继链区块中，验证人将参与可用性分布子系统以确保候选者的可用性。有关候选者可用性的信息将在随后的中继链块中被指出。</li>
<li>一旦中继链状态机有足够的信息认为候选人的 PoV 是可用的，该候选人就被认为是平行链的一部分，并逐渐成为一个完整的平行链区块，或简称为 parablock。</li>
</ol>
<p>请注意，候选人可以在以下任何一种情况下不被列入：</p>
<ul>
<li>收集人无法将该候选者传播给分配给该平行链的任何验证人。</li>
<li>候选人没有被参与候选人支持子系统的验证人支持。</li>
<li>候选人没有被中继链区块作者选择纳入中继链。</li>
<li>候选人的 PoV 在超时内不被认为是可用的，并被从中继链中丢弃。</li>
</ul>
<p>这个过程还可以进一步划分。步骤 2 和 3 与收集人的工作有关，即整理并通过整理分发子系统将候选人分发至验证人。步骤 3 和 4 涉及到候选人支持子系统中的验证人和区块作者（本身就是一个验证人）的工作，将区块纳入中继链。步骤 6、7 和 8 对应于中继链状态机的逻辑（也称为运行时），用于将区块完全纳入链中。第 7 步需要验证人的进一步工作，以参与可用性分布子系统，并将该信息纳入中继链，以便第 8 步完全实现。</p>
<p>这给我们带来了该过程的第二部分。一旦一个 parablock 被认为是可用的和平行链的一部分，它仍然是 &quot;等待批准&quot;。在流水线的这一阶段，该 parablock 已经得到了分配给该 parablock 的小组中大多数验证人的支持，其数据已经被整个验证人集合保证为可用。一旦它被认为是可用的，主机甚至会开始接受该块的子块。在这一点上，我们可以认为该区块已经被暂时包含在平行链中，尽管还需要更多的确认。然而，平行链组中的验证人（被称为该平行链的 &quot;平行链验证人&quot;）是从一个验证人集合中抽出的，这个验证人集合中含有一定比例的拜占庭，或者任意的恶意成员。这就意味着，某些区块的平行链验证人可能是多数人不诚实的，这意味着在区块被认为是被批准之前，必须对其进行（二次）批准检查。这一点是必要的，因为一个给定的 parachain 的验证人是从整个验证人集合中抽取的，而这个验证人集合被假定为最多&lt;1/3 不诚实--这意味着有机会随机抽取 parachain 的验证人，这些验证人多数或完全不诚实，可能错误地支持一个候选人。审批程序允许我们在事后发现这种错误行为，而不需要分配更多的 Parachain 验证人，并减少系统的吞吐量。一个 parablock 未能通过审批过程，将使该区块以及其所有的子代无效。然而，只有支持有问题的区块的验证人会被惩罚，而不是支持后代的验证人。</p>
<p>审批程序，一目了然，看起来像这样：</p>
<ol>
<li>被纳入流水线的 Parablocks 正在等待批准，其时间窗口被称为二次检查窗口。</li>
<li>在二次检查窗口期间，验证人随机地自我选择对 parablock 进行二次检查。</li>
<li>这些验证人在这里被称为二次检查者，他们获得了 parablock 和其 PoV，并重新运行验证功能。</li>
<li>二级检查员对他们的检查结果进行 gossip。相互矛盾的结果会导致升级，所有验证人都需要检查该块。争端中失败一方的验证人被惩罚。</li>
<li>在审批过程结束时，该区块要么被批准，要么被拒绝。稍后会有更多关于拒绝过程的内容。</li>
</ol>
<p>关于审批程序的更多信息，可在 &quot;审批&quot; 专门章节中找到。关于争议的更多信息，可在 &quot;争议&quot; 的专门章节中找到。</p>
<p>这两条流水线总结了扩展和获得一个 Parablock 的全部安全所需的事件顺序。请注意，在接受一个新的区块之前，必须结束对一个特定的 parachain 的包含流水线。纳入后，审批程序开始启动，可以同时为许多平行链区块运行。</p>
<p>重申候选人的生命周期：</p>
<ol>
<li>候选：由一个收集人向一个验证人提出。</li>
<li>附议：由一个验证人向其他验证人提出。</li>
<li>可支持：由大多数指定的验证人证明的有效性。</li>
<li>被支持：可支持的并在中继链的分叉中指出。</li>
<li>待定的可用性：有支持，但还没有被认为是可用的。</li>
<li>包含：已支持并被认为是可用的。</li>
<li>接受：已支持，可使用，且无争议。</li>
</ol>
<pre class="mermaid">
digraph {
	subgraph cluster_vg {
		label=&lt;
			Parachain Validators
			&lt;br/&gt;
			(subset of all)
		&gt;
		labeljust=l
		style=filled
		color=lightgrey
		node [style=filled color=white]

		v1 [label=&quot;Validator 1&quot;]
		v2 [label=&quot;Validator 2&quot;]
		v3 [label=&quot;Validator 3&quot;]

		b [label=&quot;(3) Backable&quot;, shape=box]

		v1 -&gt; v2 [label=&quot;(2) Seconded&quot;]
		v1 -&gt; v3 [label=&quot;(2) Seconded&quot;]

		v2 -&gt; b [style=dashed arrowhead=none]
		v3 -&gt; b [style=dashed arrowhead=none]
		v1 -&gt; b [style=dashed arrowhead=none]
	}

	v4 [label=&lt;
		&lt;b&gt;Validator 4&lt;/b&gt; (relay chain)
		&lt;br/&gt;
		&lt;font point-size=&quot;10&quot;&gt;
			(selected by BABE)
		&lt;/font&gt;
	&gt;]

	col [label=&quot;Collator&quot;]
	pa [label=&quot;(5) Relay Block (Pending Availability)&quot;, shape=box]
	pb [label=&quot;Parablock&quot;, shape=box]
	rc [label=&quot;Relay Chain Validators&quot;]

	subgraph cluster_approval {
		label=&lt;
			Secondary Checkers
			&lt;br/&gt;
			(subset of all)
		&gt;
		labeljust=l
		style=filled
		color=lightgrey
		node [style=filled color=white]

		a5 [label=&quot;Validator 5&quot;]
		a6 [label=&quot;Validator 6&quot;]
		a7 [label=&quot;Validator 7&quot;]
	}

	b -&gt; v4 [label=&quot;(4) Backed&quot;]
	col -&gt; v1 [label=&quot;(1) Candidate&quot;]
	v4 -&gt; pa
	pa -&gt; pb [label=&quot;(6) a few blocks later...&quot; arrowhead=none]
	pb -&gt; a5
	pb -&gt; a6
	pb -&gt; a7

	a5 -&gt; rc [label=&quot;(7) Approved&quot;]
	a6 -&gt; rc [label=&quot;(7) Approved&quot;]
	a7 -&gt; rc [label=&quot;(7) Approved&quot;]
}
`</pre>
<p>上图显示了一个区块从（1）候选状态到（7）批准状态的乐观路径。</p>
<p>还需要注意的是，中继链是由 BABE 扩展的，它是一种分叉算法。这意味着不同的区块作者可以同时被选择，而且可能不是建立在同一个区块父本上。此外，验证人的集合并不固定，平行链的集合也不固定。而且，即使有相同的验证人和平行链集，验证人对平行链集的分配也是灵活的。这意味着，在接下来的章节中提出的架构必须处理网络状态的可变性和多重性。</p>
<pre class="mermaid">
digraph {
	rca [label=&quot;Relay Block A&quot; shape=box]
	rcb [label=&quot;Relay Block B&quot; shape=box]
	rcc [label=&quot;Relay Block C&quot; shape=box]

	vg1 [label=&lt;
		&lt;b&gt;Validator Group 1&lt;/b&gt;
		&lt;br/&gt;
		&lt;br/&gt;
		&lt;font point-size=&quot;10&quot;&gt;
			(Validator 4)
			&lt;br/&gt;
			(Validator 1) (Validator 2)
			&lt;br/&gt;
			(Validator 5)
		&lt;/font&gt;
	&gt;]
	vg2 [label=&lt;
		&lt;b&gt;Validator Group 2&lt;/b&gt;
		&lt;br/&gt;
		&lt;br/&gt;
		&lt;font point-size=&quot;10&quot;&gt;
			(Validator 7)
			&lt;br/&gt;
			(Validator 3) (Validator 6)
		&lt;/font&gt;
	&gt;]

	rcb -&gt; rca
	rcc -&gt; rcb

	vg1 -&gt; rcc [label=&quot;Building on C&quot; style=dashed arrowhead=none]
	vg2 -&gt; rcb [label=&quot;Building on B&quot; style=dashed arrowhead=none]
}
`</pre>
<p>在这个例子中，第 1 组已经收到了 C 块，而其他组由于网络不同步而没有收到。现在，第 2 组的验证人可以在 B 的基础上建立另一个块，称为 C'。假设之后，一些验证人同时知道了 C 和 C'，而其他验证人仍然只知道一个。</p>
<pre><code class="language-meramid">digraph {
	rca [label=&quot;Relay Block A&quot; shape=box]
	rcb [label=&quot;Relay Block B&quot; shape=box]
	rcc [label=&quot;Relay Block C&quot; shape=box]
	rcc_prime [label=&quot;Relay Block C'&quot; shape=box]

	vg1 [label=&lt;
		&lt;b&gt;Validator Group 1&lt;/b&gt;
		&lt;br/&gt;
		&lt;br/&gt;
		&lt;font point-size=&quot;10&quot;&gt;
			(Validator 4) (Validator 1)
		&lt;/font&gt;
	&gt;]
	vg2 [label=&lt;
		&lt;b&gt;Validator Group 2&lt;/b&gt;
		&lt;br/&gt;
		&lt;br/&gt;
		&lt;font point-size=&quot;10&quot;&gt;
			(Validator 7) (Validator 6)
		&lt;/font&gt;
	&gt;]
	vg3 [label=&lt;
		&lt;b&gt;Validator Group 3&lt;/b&gt;
		&lt;br/&gt;
		&lt;br/&gt;
		&lt;font point-size=&quot;10&quot;&gt;
			(Validator 2) (Validator 3)
			&lt;br/&gt;
			(Validator 5)
		&lt;/font&gt;
	&gt;]

	rcb -&gt; rca
	rcc -&gt; rcb
	rcc_prime -&gt; rcb

	vg1 -&gt; rcc       [style=dashed arrowhead=none]
	vg2 -&gt; rcc_prime [style=dashed arrowhead=none]
	vg3 -&gt; rcc_prime [style=dashed arrowhead=none]
	vg3 -&gt; rcc       [style=dashed arrowhead=none]
}
</code></pre>
<p>那些意识到许多竞争头的验证人必须意识到在每个头上发生的工作。他们可能对两个头都有一些或全部的贡献。由于网络的不同步性，两个分叉有可能在一段时间内平行增长，尽管在没有对抗性网络的情况下，在有验证人知道两个链头的情况下这是不可能的。</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="审批流程"><a class="header" href="#审批流程">审批流程</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议流程"><a class="header" href="#争议流程">争议流程</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议工作流"><a class="header" href="#争议工作流">争议工作流</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="链选择和最终化"><a class="header" href="#链选择和最终化">链选择和最终化</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="架构概览"><a class="header" href="#架构概览">架构概览</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="消息概览"><a class="header" href="#消息概览">消息概览</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pvf-预检测"><a class="header" href="#pvf-预检测">PVF 预检测</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="运行时架构"><a class="header" href="#运行时架构">运行时架构</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="initializer-模块"><a class="header" href="#initializer-模块">Initializer 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="configuration-模块"><a class="header" href="#configuration-模块">Configuration 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="shared-模块"><a class="header" href="#shared-模块">Shared 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="disputes-模块"><a class="header" href="#disputes-模块">Disputes 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="paras-模块"><a class="header" href="#paras-模块">Paras 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scheduler-模块"><a class="header" href="#scheduler-模块">Scheduler 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="inclusion-模块"><a class="header" href="#inclusion-模块">Inclusion 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parainherent-模块"><a class="header" href="#parainherent-模块">ParaInherent 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="dmp-模块"><a class="header" href="#dmp-模块">DMP 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ump-模块"><a class="header" href="#ump-模块">UMP 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="hrmp-模块"><a class="header" href="#hrmp-模块">HRMP 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="session-info-模块"><a class="header" href="#session-info-模块">Session Info 模块</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="运行时-apis"><a class="header" href="#运行时-apis">运行时 APIs</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="验证人"><a class="header" href="#验证人">验证人</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="验证人-groups"><a class="header" href="#验证人-groups">验证人 Groups</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="可用性核心"><a class="header" href="#可用性核心">可用性核心</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="持久性验证数据"><a class="header" href="#持久性验证数据">持久性验证数据</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="session-索引"><a class="header" href="#session-索引">Session 索引</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="验证代码"><a class="header" href="#验证代码">验证代码</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="候选待定可用性"><a class="header" href="#候选待定可用性">候选待定可用性</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="候选者事件"><a class="header" href="#候选者事件">候选者事件</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议信息"><a class="header" href="#争议信息">争议信息</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="包含的候选者"><a class="header" href="#包含的候选者">包含的候选者</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pvf-预检查"><a class="header" href="#pvf-预检查">PVF 预检查</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="节点架构"><a class="header" href="#节点架构">节点架构</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="子系统和工作"><a class="header" href="#子系统和工作">子系统和工作</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="监督员"><a class="header" href="#监督员">监督员</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="grandpa-投票规则"><a class="header" href="#grandpa-投票规则">GRANDPA 投票规则</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="收集人子系统"><a class="header" href="#收集人子系统">收集人子系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="收集人产生"><a class="header" href="#收集人产生">收集人产生</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="收集人协议"><a class="header" href="#收集人协议">收集人协议</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="支持子系统"><a class="header" href="#支持子系统">支持子系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="候选者支持"><a class="header" href="#候选者支持">候选者支持</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="报表分发"><a class="header" href="#报表分发">报表分发</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="可用性子系统"><a class="header" href="#可用性子系统">可用性子系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="可用性分发"><a class="header" href="#可用性分发">可用性分发</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="可用性恢复"><a class="header" href="#可用性恢复">可用性恢复</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bitfield-分发"><a class="header" href="#bitfield-分发">Bitfield 分发</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="bitfield-签名"><a class="header" href="#bitfield-签名">Bitfield 签名</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="审批子系统"><a class="header" href="#审批子系统">审批子系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="审批投票"><a class="header" href="#审批投票">审批投票</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="审批分发"><a class="header" href="#审批分发">审批分发</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议子系统"><a class="header" href="#争议子系统">争议子系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议协调员"><a class="header" href="#争议协调员">争议协调员</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议分发"><a class="header" href="#争议分发">争议分发</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="实用工具子系统"><a class="header" href="#实用工具子系统">实用工具子系统</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="可用性商店"><a class="header" href="#可用性商店">可用性商店</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="候选人验证"><a class="header" href="#候选人验证">候选人验证</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="提供者"><a class="header" href="#提供者">提供者</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="网络桥"><a class="header" href="#网络桥">网络桥</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gossip-支持"><a class="header" href="#gossip-支持">Gossip 支持</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="不良行为仲裁"><a class="header" href="#不良行为仲裁">不良行为仲裁</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="对等集合管理员"><a class="header" href="#对等集合管理员">对等集合管理员</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="运行时-api-请求"><a class="header" href="#运行时-api-请求">运行时 API 请求</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="链-api-请求"><a class="header" href="#链-api-请求">链 API 请求</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="链选择请求"><a class="header" href="#链选择请求">链选择请求</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pvf-预检查-1"><a class="header" href="#pvf-预检查-1">PVF 预检查</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="数据结构和类型"><a class="header" href="#数据结构和类型">数据结构和类型</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="候选人"><a class="header" href="#候选人">候选人</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="支持"><a class="header" href="#支持">支持</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="可用性"><a class="header" href="#可用性">可用性</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="监督员和子系统协议"><a class="header" href="#监督员和子系统协议">监督员和子系统协议</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="运行时"><a class="header" href="#运行时">运行时</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="链"><a class="header" href="#链">链</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="消息"><a class="header" href="#消息">消息</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="网络"><a class="header" href="#网络">网络</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="审批"><a class="header" href="#审批">审批</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="争议"><a class="header" href="#争议">争议</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="pvf-预检查-2"><a class="header" href="#pvf-预检查-2">PVF 预检查</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="术语"><a class="header" href="#术语">术语</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="进一步阅读"><a class="header" href="#进一步阅读">进一步阅读</a></h1>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="mermaid.min.js"></script>
        <script type="text/javascript" src="mermaid-init.js"></script>

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
